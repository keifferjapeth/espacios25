/* ===== FILE: usethis1.html ===== */
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>espacios — AI for WhatsApp & Instagram</title>
  <meta name="description" content="espacios: AI automation for WhatsApp & Instagram. Integrate, deploy, and scale conversations." />

  <style>
    :root{
      --page-bg:#E6E9ED;
      --text:#0F0F10;
      --muted:rgba(90,90,90,.9);
      --accent:#B6FF3B;
      --accent-glow:rgba(182,255,59,.5);
      --font: system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Display","Inter",sans-serif;

      --glass-bg:rgba(255,255,255,.32);
      --glass-border:rgba(255,255,255,.6);
      --glass-blur:20px;

      --shadow-xl: 0 40px 120px rgba(0,0,0,.12), 0 16px 48px rgba(0,0,0,.08);
      --shadow-lg: 0 24px 64px rgba(0,0,0,.10);
      --shadow-md: 0 16px 40px rgba(0,0,0,.08);

      --ease: cubic-bezier(.16, 1, .3, 1);
      --ease-out: cubic-bezier(.0, 0, .2, 1);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      font-family:var(--font);
      background:var(--page-bg);
      color:var(--text);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
    }

    /* ========================
       INTRO OVERLAY
       ======================== */
    .intro-overlay{
      position:fixed;
      inset:0;
      z-index:1000;
      background: var(--page-bg);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:20px;
      transition: opacity .6s var(--ease), visibility .6s;
    }
    .intro-overlay.is-hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }

    .intro-logo{
      width:80px;
      height:80px;
      border-radius:24px;
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(16px);
      display:grid;
      place-items:center;
      opacity:0;
      transform: scale(0.8);
      animation: introLogoIn .7s var(--ease) .2s forwards;
    }
    .intro-logo img{
      width:50px;
      height:50px;
      object-fit:contain;
    }

    .intro-text{
      font-size:18px;
      font-weight:600;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color: rgba(15,15,16,.7);
      opacity:0;
      transform: translateY(10px);
      animation: introTextIn .6s var(--ease) .5s forwards;
    }

    .intro-bar{
      width:120px;
      height:3px;
      background: rgba(15,15,16,.08);
      border-radius:99px;
      overflow:hidden;
      opacity:0;
      animation: introBarIn .4s var(--ease) .7s forwards;
    }
    .intro-bar-fill{
      height:100%;
      width:0;
      background: linear-gradient(90deg, var(--accent), rgba(182,255,59,.6));
      border-radius:99px;
      animation: introBarFill 1.2s var(--ease-out) .9s forwards;
    }

    @keyframes introLogoIn{ to{ opacity:1; transform: scale(1); } }
    @keyframes introTextIn{ to{ opacity:1; transform: translateY(0); } }
    @keyframes introBarIn{ to{ opacity:1; } }
    @keyframes introBarFill{ to{ width:100%; } }

    /* ========================
       PAGE CONTAINER
       ======================== */
    .page{
      min-height:100vh;
      position:relative;
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(800px 500px at 85% 15%, rgba(255,255,255,.5), transparent 55%),
        radial-gradient(600px 400px at 50% 90%, rgba(255,255,255,.4), transparent 55%),
        linear-gradient(165deg, #EEF1F5 0%, #E4E7EB 45%, #D9DEE4 100%);
      opacity:0;
      transform: translateY(8px);
      transition: opacity .8s var(--ease), transform .8s var(--ease);
    }
    .page.is-visible{
      opacity:1;
      transform: translateY(0);
    }

    /* ========================
       ORBS - HOLOGRAPHIC
       ======================== */
    .orbs{
      position:absolute;
      inset:0;
      overflow:hidden;
      pointer-events:none;
      z-index:1;
    }
    .orb{
      position:absolute;
      border-radius:999px;
      filter:blur(40px);
      opacity:.5;
      mix-blend-mode:soft-light;
      will-change:transform;
    }
    .orb.o1{
      width:min(55vw,600px);
      height:min(55vw,600px);
      left:-15%;
      top:-20%;
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.9), transparent 50%),
        radial-gradient(circle at 65% 65%, rgba(182,255,59,.3), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(147,197,253,.2), transparent 60%);
    }
    .orb.o2{
      width:min(50vw,550px);
      height:min(50vw,550px);
      right:-18%;
      top:-8%;
      background:
        radial-gradient(circle at 40% 40%, rgba(255,255,255,.85), transparent 50%),
        radial-gradient(circle at 60% 70%, rgba(196,181,253,.25), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(182,255,59,.2), transparent 60%);
      opacity:.45;
    }
    .orb.o3{
      width:min(65vw,700px);
      height:min(65vw,700px);
      left:15%;
      bottom:-35%;
      background:
        radial-gradient(circle at 45% 45%, rgba(255,255,255,.8), transparent 50%),
        radial-gradient(circle at 55% 55%, rgba(182,255,59,.25), transparent 55%),
        radial-gradient(circle at 60% 40%, rgba(147,197,253,.15), transparent 60%);
      opacity:.4;
    }

    /* ========================
       NAV BAR
       ======================== */
    .nav{
      position:relative;
      z-index:10;
      width:min(1200px, calc(100% - 40px));
      margin:0 auto;
      padding:24px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .nav-brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:var(--text);
    }
    .nav-logo{
      width:42px;
      height:42px;
      border-radius:14px;
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(12px);
      display:grid;
      place-items:center;
      transition: transform .3s var(--ease), box-shadow .3s var(--ease);
    }
    .nav-logo:hover{
      transform: translateY(-2px) scale(1.02);
      box-shadow: var(--shadow-lg);
    }
    .nav-logo img{ width:26px; height:26px; object-fit:contain; }
    .nav-wordmark{ font-size:20px; font-weight:720; letter-spacing:-0.02em; }

    .nav-links{ display:flex; align-items:center; gap:8px; }
    .nav-link{
      padding:10px 16px;
      border-radius:12px;
      font-size:14px;
      font-weight:600;
      color:rgba(15,15,16,.7);
      text-decoration:none;
      transition: all .25s var(--ease);
      background:transparent;
      border:1px solid transparent;
    }
    .nav-link:hover{
      color:var(--text);
      background: rgba(255,255,255,.4);
      border-color: rgba(255,255,255,.5);
    }

    .nav-cta{
      padding:10px 18px;
      border-radius:14px;
      font-size:14px;
      font-weight:700;
      color:rgba(15,15,16,.85);
      text-decoration:none;
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(12px);
      transition: all .25s var(--ease);
      cursor:pointer;
    }
    .nav-cta:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
      background: rgba(255,255,255,.45);
    }

    /* ========================
       HERO SECTION
       ======================== */
    .hero{
      position:relative;
      z-index:5;
      width:min(1200px, calc(100% - 40px));
      margin:0 auto;
      padding:60px 0 100px;
      display:grid;
      grid-template-columns:1.1fr 1fr;
      gap:60px;
      align-items:center;
    }

    .hero-content{ position:relative; }

    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 16px;
      border-radius:999px;
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(14px);
      font-size:13px;
      font-weight:600;
      color:rgba(15,15,16,.7);
      margin-bottom:24px;
      opacity:0;
      transform: translateY(12px);
      animation: fadeUp .7s var(--ease) 2.3s forwards;
    }
    .badge-dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(182,255,59,.2), 0 0 12px rgba(182,255,59,.4);
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ box-shadow: 0 0 0 4px rgba(182,255,59,.2), 0 0 12px rgba(182,255,59,.4); }
      50%{ box-shadow: 0 0 0 8px rgba(182,255,59,.1), 0 0 20px rgba(182,255,59,.3); }
    }

    .hero-title{
      font-size:clamp(42px, 5.5vw, 72px);
      line-height:1.0;
      letter-spacing:-0.04em;
      font-weight:780;
      margin-bottom:20px;
      opacity:0;
      transform: translateY(16px);
      animation: fadeUp .8s var(--ease) 2.45s forwards;
    }
    .hero-title .highlight{
      background: linear-gradient(135deg, var(--accent) 0%, rgba(182,255,59,.7) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-sub{
      font-size:17px;
      line-height:1.6;
      color:var(--muted);
      max-width:480px;
      margin-bottom:32px;
      opacity:0;
      transform: translateY(14px);
      animation: fadeUp .7s var(--ease) 2.6s forwards;
    }

    .hero-ctas{
      display:flex;
      align-items:center;
      gap:14px;
      flex-wrap:wrap;
      opacity:0;
      transform: translateY(12px);
      animation: fadeUp .7s var(--ease) 2.75s forwards;
    }

    .btn-primary{
      position:relative;
      padding:16px 28px;
      border-radius:18px;
      font-size:15px;
      font-weight:700;
      color: rgba(10,10,10,.9);
      background: linear-gradient(135deg, var(--accent) 0%, rgba(182,255,59,.85) 100%);
      border:1px solid rgba(182,255,59,.5);
      box-shadow:
        0 20px 50px rgba(182,255,59,.25),
        0 8px 24px rgba(0,0,0,.08),
        inset 0 1px 0 rgba(255,255,255,.4);
      cursor:pointer;
      transition: all .3s var(--ease);
      overflow:hidden;
    }
    .btn-primary::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(135deg, rgba(255,255,255,.3) 0%, transparent 50%);
      opacity:0;
      transition: opacity .3s;
    }
    .btn-primary:hover{
      transform: translateY(-2px) scale(1.02);
      box-shadow:
        0 28px 60px rgba(182,255,59,.3),
        0 12px 32px rgba(0,0,0,.1),
        inset 0 1px 0 rgba(255,255,255,.5);
    }
    .btn-primary:hover::before{ opacity:1; }
    .btn-primary:active{ transform: translateY(0) scale(0.99); }

    .btn-secondary{
      padding:16px 24px;
      border-radius:18px;
      font-size:15px;
      font-weight:600;
      color: rgba(15,15,16,.75);
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(14px);
      cursor:pointer;
      transition: all .3s var(--ease);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn-secondary:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      background: rgba(255,255,255,.45);
      color: var(--text);
    }
    .btn-secondary svg{ width:18px; height:18px; fill:currentColor; transition: transform .3s var(--ease); }
    .btn-secondary:hover svg{ transform: translateX(3px); }

    .hero-stats{
      display:flex;
      align-items:center;
      gap:32px;
      margin-top:40px;
      padding-top:32px;
      border-top:1px solid rgba(15,15,16,.06);
      opacity:0;
      transform: translateY(12px);
      animation: fadeUp .7s var(--ease) 2.9s forwards;
    }
    .stat{ display:flex; flex-direction:column; gap:4px; }
    .stat-value{ font-size:28px; font-weight:750; letter-spacing:-0.03em; color:var(--text); }
    .stat-label{ font-size:13px; color:var(--muted); }

    /* ========================
       HERO VISUAL
       ======================== */
    .hero-visual{
      position:relative;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:500px;
    }

    /* Main glass card */
    .visual-card{
      position:relative;
      width:340px;
      padding:32px;
      border-radius:32px;
      background: linear-gradient(145deg, rgba(255,255,255,.45), rgba(255,255,255,.2));
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow-xl);
      backdrop-filter: blur(var(--glass-blur));
      opacity:0;
      transform: translateY(20px) scale(0.96);
      animation: visualCardIn .9s var(--ease) 2.4s forwards;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }
    .visual-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:32px;
      background: linear-gradient(135deg,
        rgba(255,255,255,.5) 0%,
        rgba(255,255,255,.1) 30%,
        rgba(147,197,253,.08) 50%,
        rgba(196,181,253,.08) 70%,
        rgba(255,255,255,.3) 100%
      );
      pointer-events:none;
      animation: holoShift 6s ease-in-out infinite;
    }
    .visual-card::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:32px;
      box-shadow: inset 0 1px 1px rgba(255,255,255,.7), inset 0 -1px 1px rgba(15,15,16,.03);
      pointer-events:none;
    }

    /* Subtle interior sheen */
    .visual-sheen{
      position:absolute;
      inset:-30%;
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.6), transparent 45%),
        radial-gradient(circle at 65% 65%, rgba(182,255,59,.16), transparent 55%);
      opacity:.55;
      filter: blur(18px);
      transform: translate3d(0,0,0);
      animation: sheenDrift 9s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sheenDrift{
      0%,100%{ transform: translate3d(-2%, -1%, 0) rotate(0deg); }
      50%{ transform: translate3d(2%, 1.5%, 0) rotate(6deg); }
    }

    @keyframes holoShift{ 0%,100%{ opacity:.6; } 50%{ opacity:.85; } }
    @keyframes visualCardIn{ to{ opacity:1; transform: translateY(0) scale(1); } }

    /* ========================
       CARD CONTENT
       ======================== */
    .card-inner{
      position:relative;
      z-index:2;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }

    .card-logo{
      width:72px;
      height:72px;
      border-radius:22px;
      background: rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.7);
      box-shadow: 0 16px 40px rgba(0,0,0,.08);
      backdrop-filter: blur(12px);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
      transition: transform .4s var(--ease), box-shadow .4s var(--ease);
    }
    .card-logo:hover{
      transform: translateY(-3px) scale(1.03);
      box-shadow: 0 22px 50px rgba(0,0,0,.10);
    }
    .card-logo img{
      width:44px;
      height:44px;
      object-fit:contain;
    }

    /* Logo glow effect */
    .card-logo::after{
      content:"";
      position:absolute;
      inset:-50%;
      background: radial-gradient(closest-side at 40% 35%, rgba(182,255,59,.28), transparent 60%);
      filter: blur(16px);
      opacity:0;
      pointer-events:none;
      animation: logoGlowPulse 3s ease-in-out infinite;
    }
    @keyframes logoGlowPulse{
      0%,100%{ opacity:0; transform: scale(0.9); }
      50%{ opacity:1; transform: scale(1.1); }
    }

    .card-title{
      font-size:22px;
      font-weight:800;
      letter-spacing:-0.02em;
      color: rgba(15,15,16,.92);
      line-height:1.2;
    }

    .card-sub{
      font-size:13px;
      color: rgba(15,15,16,.6);
      line-height:1.5;
      max-width:260px;
    }

    .card-cta{
      margin-top:8px;
      appearance:none;
      border:1px solid rgba(255,255,255,.6);
      background: rgba(255,255,255,.5);
      border-radius:999px;
      padding:14px 24px;
      font-size:13px;
      font-weight:800;
      letter-spacing:-0.01em;
      color: rgba(15,15,16,.85);
      box-shadow: 0 12px 32px rgba(0,0,0,.08);
      cursor:pointer;
      transition: all .3s var(--ease);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .card-cta:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
    }
    .card-cta:active{
      transform: translateY(0) scale(0.98);
    }
    .card-cta svg{
      width:16px;
      height:16px;
      fill:currentColor;
      transition: transform .3s var(--ease);
    }
    .card-cta:hover svg{
      transform: translateX(3px);
    }

    /* Accent ring around card on hover */
    .visual-card:hover .card-logo::after{
      animation: logoGlowPulse 2s ease-in-out infinite;
    }

    @keyframes fadeUp{ to{ opacity:1; transform: translateY(0); } }

    /* ========================
       SIMULATION OVERLAY
       ======================== */
    .sim-overlay{
      position:fixed;
      inset:0;
      z-index:100;
      background: rgba(230,233,237,.92);
      backdrop-filter: blur(20px);
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      visibility:hidden;
      transition: opacity .4s var(--ease), visibility .4s;
    }
    .sim-overlay.is-open{
      opacity:1;
      visibility:visible;
    }
    .sim-overlay iframe{
      width:100%;
      height:100%;
      border:none;
    }
    .sim-close{
      position:absolute;
      top:20px;
      right:20px;
      width:48px;
      height:48px;
      border-radius:16px;
      background: rgba(255,255,255,.5);
      border:1px solid rgba(255,255,255,.7);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(12px);
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: all .25s var(--ease);
      z-index:10;
    }
    .sim-close:hover{
      transform: scale(1.05);
      background: rgba(255,255,255,.7);
    }
    .sim-close svg{
      width:20px;
      height:20px;
      stroke: rgba(15,15,16,.7);
      stroke-width:2.5;
      fill:none;
    }

    /* ========================
       RESPONSIVE
       ======================== */
    @media (max-width: 1000px){
      .hero{ grid-template-columns:1fr; gap:50px; padding:40px 0 80px; }
      .hero-content{ text-align:center; }
      .hero-sub{ margin-left:auto; margin-right:auto; }
      .hero-ctas{ justify-content:center; }
      .hero-stats{ justify-content:center; }
      .hero-visual{ min-height:auto; }
      .nav-links{ display:none; }
    }

    @media (max-width: 600px){
      .nav{ padding:16px 0; }
      .nav-wordmark{ display:none; }
      .hero-title{ font-size:36px; }
      .hero-sub{ font-size:15px; }
      .hero-stats{ gap:20px; }
      .stat-value{ font-size:24px; }
      .visual-card{ width:290px; padding:28px; }
      .card-logo{ width:64px; height:64px; }
      .card-logo img{ width:38px; height:38px; }
      .card-title{ font-size:20px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *, *::before, *::after{
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .intro-overlay{ display:none; }
      .page{ opacity:1; transform:none; }
    }
  </style>
</head>

<body>
  <!-- INTRO OVERLAY -->
  <div class="intro-overlay" id="introOverlay">
    <div class="intro-logo">
      <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios" />
    </div>
    <div class="intro-text">espacios</div>
    <div class="intro-bar"><div class="intro-bar-fill"></div></div>
  </div>

  <!-- MAIN PAGE -->
  <main class="page" id="page">
    <!-- ORBS -->
    <div class="orbs" aria-hidden="true">
      <div class="orb o1"></div>
      <div class="orb o2"></div>
      <div class="orb o3"></div>
    </div>

    <!-- NAV -->
    <nav class="nav">
      <a href="#" class="nav-brand">
        <div class="nav-logo">
          <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios" />
        </div>
        <span class="nav-wordmark">espacios</span>
      </a>
      <div class="nav-links">
        <a href="#" class="nav-link">Features</a>
        <a href="#" class="nav-link">Pricing</a>
        <a href="#" class="nav-link">Docs</a>
        <button class="nav-cta">Get Started</button>
      </div>
    </nav>

    <!-- HERO -->
    <section class="hero">
      <!-- Content -->
      <div class="hero-content">
        <div class="hero-badge"><span class="badge-dot"></span>AI for WhatsApp & Instagram</div>

        <h1 class="hero-title">
          Automate conversations,<br/>
          <span class="highlight">not relationships.</span>
        </h1>

        <p class="hero-sub">
          Deploy AI agents that qualify leads, answer questions, and hand off to your team — all while syncing to your CRM in real-time.
        </p>

        <div class="hero-ctas">
          <button class="btn-primary" id="ctaPrimary">Start Free Trial</button>
          <button class="btn-secondary" id="ctaSecondary">
            Watch Demo
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </button>
        </div>

        <div class="hero-stats">
          <div class="stat">
            <span class="stat-value" id="statLeads">50K+</span>
            <span class="stat-label">Leads qualified</span>
          </div>
          <div class="stat">
            <span class="stat-value">3 min</span>
            <span class="stat-label">Avg. response time</span>
          </div>
          <div class="stat">
            <span class="stat-value">98%</span>
            <span class="stat-label">Accuracy rate</span>
          </div>
        </div>
      </div>

      <!-- Visual -->
      <div class="hero-visual">
        <div class="visual-card">
          <div class="visual-sheen"></div>
          
          <div class="card-inner">
            <div class="card-logo">
              <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios" />
            </div>
            
            <h3 class="card-title">Build Your Own</h3>
            <p class="card-sub">Design agentic workflows that talk, qualify, and close — powered by AI.</p>
            
            <button class="card-cta" id="launchSim">
              Try the Simulation
              <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- SIMULATION OVERLAY -->
  <div class="sim-overlay" id="simOverlay">
    <button class="sim-close" id="simClose">
      <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
    <iframe id="simFrame" src="about:blank"></iframe>
  </div>

  <script>
    // Intro sequence
    const intro = document.getElementById('introOverlay');
    const page = document.getElementById('page');

    setTimeout(() => {
      intro.classList.add('is-hidden');
      page.classList.add('is-visible');
    }, 2100);

    // Haptics
    const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    function haptic(pattern){
      try{
        if(reduce) return;
        if('vibrate' in navigator) navigator.vibrate(pattern);
      }catch(_){ }
    }

    // Button interactions
    document.querySelectorAll('button').forEach(el => {
      el.addEventListener('pointerdown', () => haptic(8), {passive:true});
    });

    document.getElementById('ctaPrimary')?.addEventListener('click', () => {
      haptic([10, 20, 10]);
    });

    // Simulation overlay
    const simOverlay = document.getElementById('simOverlay');
    const simFrame = document.getElementById('simFrame');
    const launchSim = document.getElementById('launchSim');
    const simClose = document.getElementById('simClose');

    launchSim?.addEventListener('click', () => {
      haptic([10, 20, 10]);
      // Load the simulation (adjust path as needed)
      simFrame.src = 'espacios_simulation_anchor-logo_DUAL-mobile_ACTIVE.html';
      simOverlay.classList.add('is-open');
      document.body.style.overflow = 'hidden';
    });

    simClose?.addEventListener('click', () => {
      haptic([8]);
      simOverlay.classList.remove('is-open');
      document.body.style.overflow = '';
      setTimeout(() => { simFrame.src = 'about:blank'; }, 400);
    });

    // Close on escape
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && simOverlay.classList.contains('is-open')){
        simClose.click();
      }
    });

    // Orb parallax
    (function(){
      const orbs = Array.from(document.querySelectorAll('.orb'));
      if(!orbs.length || reduce) return;

      const state = { mx:0, my:0, tx:0, ty:0, t:0 };

      window.addEventListener('pointermove', (e)=>{
        state.tx = (e.clientX / window.innerWidth) - 0.5;
        state.ty = (e.clientY / window.innerHeight) - 0.5;
      }, {passive:true});

      function raf(){
        state.mx += (state.tx - state.mx) * 0.04;
        state.my += (state.ty - state.my) * 0.04;
        state.t += 0.006;

        orbs.forEach((orb, i)=>{
          const driftX = Math.sin(state.t * (0.8 + i*0.1)) * (16 + i*8);
          const driftY = Math.cos(state.t * (1.0 + i*0.08)) * (14 + i*8);
          const px = state.mx * (25 + i*15) + driftX;
          const py = state.my * (20 + i*12) + driftY;
          orb.style.transform = `translate3d(${px}px, ${py}px, 0)`;
        });

        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);
    })();

    // Animated counter
    function animateCounter(el, target, duration = 1500){
      const startTime = performance.now();
      const suffix = target.toString().includes('K') ? 'K+' : '+';
      const num = parseInt(target.toString().replace(/\D/g, ''));

      function update(currentTime){
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(eased * num);
        el.textContent = current + suffix;

        if(progress < 1) requestAnimationFrame(update);
      }

      setTimeout(() => requestAnimationFrame(update), 3000);
    }

    const statLeads = document.getElementById('statLeads');
    if(statLeads && !reduce){
      animateCounter(statLeads, '50K+', 1800);
    }
  </script>
</body>
</html>


/* ===== FILE: animation usable.html ===== */
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>espacios — Design Your AI</title>
  <meta name="description" content="espacios: AI automation for WhatsApp & Instagram. Design, simulate, deploy." />

  <style>
    :root {
      --page-bg: #E6E9ED;
      --text: rgba(15,15,16,.90);
      --muted: rgba(90,90,90,.88);

      --glass-bg: rgba(255,255,255,.32);
      --glass-border: rgba(255,255,255,.58);
      --glass-blur: 20px;

      --shadow-xl: 0 45px 120px rgba(0,0,0,.12), 0 18px 50px rgba(0,0,0,.08);
      --shadow-lg: 0 28px 70px rgba(0,0,0,.10), 0 10px 30px rgba(0,0,0,.06);
      --shadow-md: 0 16px 40px rgba(0,0,0,.08);
      --shadow-sm: 0 8px 24px rgba(0,0,0,.05);

      --accent: #B6FF3B;
      --accent-glow: rgba(182,255,59,.5);

      --radius: 28px;
      --radius-sm: 18px;
      --pill: 999px;

      --ease: cubic-bezier(.16, 1, .3, 1);
      --ease-out: cubic-bezier(.0, 0, .2, 1);
      --ease-bounce: cubic-bezier(.34, 1.56, .64, 1);

      --font: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    
    body {
      font-family: var(--font);
      color: var(--text);
      background: var(--page-bg);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      perspective: 1400px;
    }

    /* ========================
       AMBIENT BACKGROUND
       ======================== */
    .bg-ambient {
      position: fixed;
      inset: -35vh -35vw;
      pointer-events: none;
      z-index: -1;
      background:
        radial-gradient(1000px 600px at 10% 15%, rgba(182,255,59,.10), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(147,197,253,.14), transparent 55%),
        radial-gradient(800px 450px at 50% 85%, rgba(196,181,253,.12), transparent 55%),
        radial-gradient(1400px 800px at 50% 50%, rgba(255,255,255,.55), transparent 65%),
        linear-gradient(165deg, #EEF1F5 0%, #E4E7EB 45%, #D9DEE4 100%);
      animation: ambientDrift 22s ease-in-out infinite;
    }

    @keyframes ambientDrift {
      0%, 100% { transform: translate3d(0, 0, 0) scale(1) rotate(0deg); }
      33% { transform: translate3d(-1.2%, -0.8%, 0) scale(1.012) rotate(0.4deg); }
      66% { transform: translate3d(0.8%, -1.2%, 0) scale(1.018) rotate(-0.3deg); }
    }

    /* ========================
       CARD STACK CONTAINER
       ======================== */
    .stack-container {
      position: relative;
      width: 100%;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .card-stack {
      position: relative;
      width: min(920px, 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    /* Side-by-side layout for chat + CRM on desktop */
    .cards-row {
      display: flex;
      gap: 16px;
      width: 100%;
      align-items: flex-start;
      opacity: 0;
      transform: translateY(30px);
      pointer-events: none;
      transition: 
        opacity .7s var(--ease),
        transform .75s var(--ease);
    }

    /* ===============================
       DECK MODE — one card at a time
       other cards peek behind (~75%)
       =============================== */
    .cards-row.deck{ position:relative; }
    .cards-row.deck .card{
      position:relative;
      transition: transform .9s var(--ease), opacity .9s var(--ease), filter .9s var(--ease);
      will-change: transform, opacity;
    }
    .cards-row.deck .card.is-peek{
      max-height:75%;
      overflow:hidden;
      opacity:.92;
    }
    .cards-row.deck.stage-select #cardDesigner{ z-index:3; transform: translateY(0) scale(1); }
    .cards-row.deck.stage-select #cardChat{     z-index:2; transform: translateY(26px) scale(0.96); }
    .cards-row.deck.stage-select #cardCrm{      z-index:1; transform: translateY(52px) scale(0.93); opacity:.85; }

    .cards-row.deck.stage-chat #cardChat{       z-index:3; transform: translateY(0) scale(1); }
    .cards-row.deck.stage-chat #cardDesigner{   z-index:2; transform: translateY(26px) scale(0.96); opacity:.92; }
    .cards-row.deck.stage-chat #cardCrm{        z-index:1; transform: translateY(52px) scale(0.93); opacity:.85; }

    .cards-row.deck.stage-crm #cardCrm{         z-index:3; transform: translateY(0) scale(1); opacity:1; }
    .cards-row.deck.stage-crm #cardChat{        z-index:2; transform: translateY(26px) scale(0.96); opacity:.92; }
    .cards-row.deck.stage-crm #cardDesigner{    z-index:1; transform: translateY(52px) scale(0.93); opacity:.85; }

    @media (max-width: 800px){
      .cards-row.deck{ flex-direction:column; gap:14px; }
      .cards-row.deck .card.is-peek{ max-height:72%; }
      .cards-row.deck.stage-select #cardChat,
      .cards-row.deck.stage-chat #cardDesigner,
      .cards-row.deck.stage-crm #cardChat{
        transform: translateY(18px) scale(0.97);
      }
      .cards-row.deck.stage-select #cardCrm,
      .cards-row.deck.stage-chat #cardCrm,
      .cards-row.deck.stage-crm #cardDesigner{
        transform: translateY(36px) scale(0.95);
      }
    }


    .cards-row.is-visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    /* ========================
       LIQUID GLASS CARD BASE
       ======================== */
    .glass-card {
      position: relative;
      width: 100%;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(var(--glass-blur)) saturate(1.5);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(1.5);
      overflow: visible;
      transform-origin: center top;
      will-change: transform, opacity;
    }

    /* Holographic sheen */
    .glass-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: var(--radius);
      background: linear-gradient(135deg,
        rgba(255,255,255,.55) 0%,
        rgba(255,255,255,.12) 28%,
        rgba(147,197,253,.08) 45%,
        rgba(182,255,59,.06) 55%,
        rgba(196,181,253,.08) 70%,
        rgba(255,255,255,.35) 100%
      );
      opacity: .75;
      pointer-events: none;
      animation: holoSheen 9s ease-in-out infinite;
    }

    @keyframes holoSheen {
      0%, 100% { opacity: .6; }
      50% { opacity: .85; }
    }

    /* Inner highlight */
    .glass-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: var(--radius);
      pointer-events: none;
      box-shadow:
        inset 0 1px 1px rgba(255,255,255,.7),
        inset 0 -1px 1px rgba(15,15,16,.03);
    }

    .glass-card > * { position: relative; z-index: 2; }

    /* ========================
       ROLE DESIGNER CARD
       ======================== */
    .card-designer {
      z-index: 30;
      width: min(440px, 100%);
      transition: 
        transform .7s var(--ease),
        box-shadow .6s var(--ease),
        opacity .5s var(--ease),
        width .7s var(--ease),
        margin-bottom .6s var(--ease);
    }

    .card-designer.is-docked {
      position: relative;
      margin-bottom: 20px;
      transform: scale(0.78) translateZ(-30px);
      width: 360px;
      z-index: 10;
      opacity: .9;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      align-self: center;
    }

    .card-designer.is-docked:hover {
      transform: scale(0.8) translateZ(-20px);
      opacity: .95;
      box-shadow: var(--shadow-md);
    }

    .card-designer.is-docked .designer-inner {
      padding: 12px 14px;
    }

    .card-designer.is-docked .designer-header {
      margin-bottom: 8px;
    }

    .card-designer.is-docked .designer-title {
      font-size: 11px;
    }

    .card-designer.is-docked .role-floats {
      display: none;
    }

    .designer-inner {
      padding: 18px;
      transition: padding .5s var(--ease);
    }

    .designer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .designer-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .designer-logo {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.7);
      padding: 5px;
      display: grid;
      place-items: center;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
    }

    .designer-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .designer-title {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: -0.01em;
      transition: font-size .4s var(--ease);
    }

    .designer-subtitle {
      font-size: 11px;
      color: var(--muted);
      margin-top: 1px;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.6);
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
    }

    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: var(--pill);
      background: var(--accent);
      box-shadow: 
        0 0 0 3px rgba(182,255,59,.18),
        0 0 14px rgba(182,255,59,.35);
      animation: livePulse 2.2s ease-in-out infinite;
    }

    @keyframes livePulse {
      0%, 100% { transform: scale(1); opacity: .85; }
      50% { transform: scale(1.18); opacity: 1; }
    }

    /* Role buttons */
    .role-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 12px;
      border-radius: 20px;
      background: rgba(255,255,255,.32);
      border: 1px solid rgba(255,255,255,.5);
      backdrop-filter: blur(12px);
    }

    .role-btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,.6);
      background: rgba(255,255,255,.48);
      color: rgba(15,15,16,.78);
      border-radius: var(--pill);
      padding: 10px 14px;
      font-size: 12px;
      font-weight: 650;
      letter-spacing: -0.01em;
      cursor: pointer;
      transition: 
        transform .3s var(--ease),
        box-shadow .3s var(--ease),
        background .3s var(--ease),
        border-color .3s var(--ease);
      box-shadow: var(--shadow-sm);
      user-select: none;
    }

    .role-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      background: rgba(255,255,255,.58);
    }

    .role-btn.is-active {
      border-color: rgba(182,255,59,.5);
      background: linear-gradient(135deg, rgba(182,255,59,.28), rgba(255,255,255,.52));
      color: rgba(15,15,16,.92);
      box-shadow: 
        0 18px 45px rgba(182,255,59,.16),
        var(--shadow-md);
    }

    /* Floating role heads */
    .role-floats {
      position: absolute;
      inset: -30px;
      pointer-events: none;
      z-index: -1;
      transition: opacity .4s var(--ease);
    }

    .role-float {
      position: absolute;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: var(--pill);
      background: linear-gradient(145deg, rgba(255,255,255,.52), rgba(255,255,255,.25));
      border: 1px solid rgba(255,255,255,.65);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(14px);
      opacity: 0;
      transform: translateY(12px) scale(.95);
      animation: floatIn .7s var(--ease) forwards;
      transition: 
        filter .35s var(--ease),
        transform .35s var(--ease),
        box-shadow .35s var(--ease);
    }

    .role-float .head {
      width: 28px;
      height: 28px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.6);
      border: 1px solid rgba(255,255,255,.7);
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
    }

    .role-float .head::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 30% 30%, rgba(182,255,59,.25), transparent 55%);
      filter: blur(8px);
      opacity: .5;
    }

    .role-float svg {
      width: 16px;
      height: 16px;
      fill: rgba(15,15,16,.58);
      position: relative;
      z-index: 1;
    }

    .role-float .label {
      font-size: 11px;
      font-weight: 700;
      color: rgba(15,15,16,.72);
      white-space: nowrap;
    }

    .rf-1 { left: -45px; top: 20%; animation-delay: .1s; }
    .rf-2 { right: -50px; top: 30%; animation-delay: .2s; }
    .rf-3 { left: -40px; bottom: 25%; animation-delay: .3s; }
    .rf-4 { right: -45px; bottom: 20%; animation-delay: .4s; }

    @keyframes floatIn {
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .role-float.is-highlighted {
      filter: drop-shadow(0 12px 24px rgba(182,255,59,.22));
      transform: scale(1.04);
      box-shadow: var(--shadow-lg);
    }

    /* ========================
       CHAT CARD
       ======================== */
    .card-chat {
      flex: 1.15;
      min-width: 0;
      z-index: 25;
      box-shadow: var(--shadow-xl);
    }

    .card-chat.is-secondary {
      z-index: 20;
    }

    .chat-inner {
      padding: 16px;
    }

    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px;
      border-radius: 20px;
      background: rgba(255,255,255,.48);
      border: 1px solid rgba(255,255,255,.6);
      margin-bottom: 12px;
    }

    .chat-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chat-avatar {
      width: 30px;
      height: 30px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.6);
      border: 1px solid rgba(255,255,255,.7);
      padding: 4px;
      display: grid;
      place-items: center;
    }

    .chat-avatar img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .chat-meta b {
      display: block;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .chat-meta span {
      font-size: 11px;
      color: var(--muted);
    }

    .chat-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: var(--pill);
      background: rgba(37,211,102,.9);
      box-shadow: 0 0 0 3px rgba(37,211,102,.15), 0 0 10px rgba(37,211,102,.3);
    }

    /* Chat messages */
    .chat-messages {
      height: 320px;
      border-radius: 22px;
      background: rgba(255,255,255,.25);
      border: 1px solid rgba(255,255,255,.52);
      backdrop-filter: blur(14px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .messages-scroll {
      flex: 1;
      padding: 14px;
      overflow-y: auto;
      scrollbar-width: none;
    }

    .messages-scroll::-webkit-scrollbar {
      display: none;
    }

    .bubble-row {
      display: flex;
      margin: 8px 0;
    }

    .bubble {
      max-width: 82%;
      padding: 10px 13px;
      border-radius: 16px;
      font-size: 13px;
      line-height: 1.45;
      letter-spacing: -0.01em;
      opacity: 0;
      transform: translateY(10px) scale(0.97);
      animation: bubbleIn .5s var(--ease) forwards;
      white-space: pre-wrap;
    }

    .bubble.user {
      margin-left: auto;
      background: linear-gradient(135deg, rgba(220,248,198,.65), rgba(220,248,198,.42));
      border: 1px solid rgba(37,211,102,.15);
      color: rgba(15,15,16,.88);
    }

    .bubble.ai {
      margin-right: auto;
      background: rgba(255,255,255,.6);
      border: 1px solid rgba(255,255,255,.55);
      color: rgba(15,15,16,.88);
    }

    @keyframes bubbleIn {
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .typing-row {
      display: flex;
      margin: 10px 0;
    }

    .typing-indicator {
      margin-right: auto;
      padding: 10px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.58);
      border: 1px solid rgba(255,255,255,.55);
      display: flex;
      gap: 5px;
      align-items: center;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .35s var(--ease), transform .35s var(--ease);
    }

    .typing-indicator.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      border-radius: var(--pill);
      background: rgba(15,15,16,.35);
      animation: typingBounce 1.3s ease-in-out infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: .15s; }
    .typing-dot:nth-child(3) { animation-delay: .3s; }

    @keyframes typingBounce {
      0%, 100% { transform: translateY(0); opacity: .35; }
      50% { transform: translateY(-4px); opacity: .8; }
    }

    /* Compose bar */
    .compose-bar {
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.25);
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .compose-input {
      flex: 1;
      height: 40px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.5);
      border: 1px solid rgba(255,255,255,.65);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      padding: 0 14px;
      font-size: 12px;
      color: rgba(15,15,16,.55);
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .send-btn {
      width: 42px;
      height: 42px;
      border-radius: var(--pill);
      border: 1px solid rgba(182,255,59,.45);
      background: linear-gradient(135deg, rgba(182,255,59,.6), rgba(255,255,255,.38));
      box-shadow: 0 14px 35px rgba(182,255,59,.16), var(--shadow-md);
      display: grid;
      place-items: center;
    }

    .send-btn svg {
      width: 18px;
      height: 18px;
      fill: rgba(15,15,16,.85);
    }

    /* ========================
       CRM CARD
       ======================== */
    .card-crm {
      flex: 1;
      min-width: 0;
      z-index: 20;
      opacity: 0;
      transform: translateX(20px) scale(0.95);
      pointer-events: none;
      transition: 
        transform .8s var(--ease),
        opacity .7s var(--ease);
    }

    .card-crm.is-visible {
      opacity: 1;
      transform: translateX(0) scale(1);
      pointer-events: auto;
    }

    .card-crm.is-active {
      box-shadow: var(--shadow-xl);
      z-index: 28;
    }

    .crm-inner {
      padding: 14px;
    }

    .crm-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,.45);
      margin-bottom: 12px;
    }

    .crm-title-block b {
      display: block;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .crm-title-block span {
      font-size: 11px;
      color: var(--muted);
    }

    /* CRM Platform badges */
    .crm-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .crm-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.48);
      border: 1px solid rgba(255,255,255,.62);
      font-size: 10px;
      font-weight: 700;
      color: rgba(15,15,16,.68);
      opacity: 0;
      transform: translateY(8px) scale(0.9);
      transition: 
        opacity .5s var(--ease),
        transform .5s var(--ease),
        border-color .3s var(--ease),
        box-shadow .3s var(--ease);
    }

    .crm-badge.is-visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .crm-badge.is-active {
      border-color: rgba(182,255,59,.45);
      box-shadow: 0 0 0 3px rgba(182,255,59,.12), 0 0 20px rgba(182,255,59,.18);
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: var(--pill);
      background: rgba(15,15,16,.2);
      transition: background .3s, box-shadow .3s;
    }

    .crm-badge.is-active .badge-dot {
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(182,255,59,.15), 0 0 12px rgba(182,255,59,.35);
    }

    /* CRM Fields */
    .crm-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }

    .crm-field {
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.58);
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
      transition: 
        transform .4s var(--ease),
        box-shadow .4s var(--ease),
        border-color .3s var(--ease);
    }

    .crm-field.is-updated {
      transform: translateY(-2px);
      border-color: rgba(182,255,59,.45);
      box-shadow: 
        0 18px 45px rgba(182,255,59,.14),
        var(--shadow-md);
    }

    .crm-field.is-updated::after {
      content: "";
      position: absolute;
      inset: -50%;
      background: radial-gradient(circle at 30% 30%, rgba(182,255,59,.25), transparent 60%);
      filter: blur(14px);
      opacity: .85;
      animation: fieldFlash 1.1s var(--ease) forwards;
    }

    @keyframes fieldFlash {
      0% { opacity: .85; transform: translateX(-8%) translateY(-8%); }
      100% { opacity: 0; transform: translateX(8%) translateY(8%); }
    }

    .crm-field b {
      display: block;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .03em;
      text-transform: uppercase;
      color: rgba(15,15,16,.52);
      margin-bottom: 3px;
    }

    .crm-field span {
      display: block;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: -0.01em;
      color: rgba(15,15,16,.85);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color .3s var(--ease);
    }

    .crm-field.is-updated span {
      color: rgba(15,15,16,.95);
    }

    /* CRM Sync indicator */
    .crm-sync {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-top: 10px;
      color: var(--muted);
      font-size: 11px;
    }

    .sync-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 11px;
      border-radius: var(--pill);
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.6);
      transition: border-color .3s, box-shadow .3s;
    }

    .sync-chip.is-syncing {
      border-color: rgba(182,255,59,.4);
      box-shadow: 0 0 0 3px rgba(182,255,59,.1), 0 0 18px rgba(182,255,59,.15);
    }

    .sync-icon {
      width: 16px;
      height: 16px;
      border-radius: var(--pill);
      background: rgba(15,15,16,.1);
      position: relative;
      overflow: hidden;
      transition: background .3s, box-shadow .3s;
    }

    .sync-chip.is-syncing .sync-icon {
      background: rgba(182,255,59,.25);
      box-shadow: 0 0 0 3px rgba(182,255,59,.12), 0 0 14px rgba(182,255,59,.25);
    }

    .sync-icon::after {
      content: "";
      position: absolute;
      inset: -30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), transparent 60%);
      filter: blur(4px);
      opacity: .55;
    }

    .sync-line {
      flex: 1;
      height: 2px;
      border-radius: var(--pill);
      background: linear-gradient(90deg, transparent, rgba(182,255,59,.5), transparent);
      opacity: 0;
      transition: opacity .4s;
    }

    .crm-sync.is-syncing .sync-line {
      opacity: .85;
      animation: syncSweep 1.4s ease-in-out infinite;
    }

    @keyframes syncSweep {
      0%, 100% { transform: translateX(-10%); }
      50% { transform: translateX(10%); }
    }

    /* ========================
       RESPONSIVE
       ======================== */
    @media (max-width: 800px) {
      .card-stack {
        width: min(440px, 100%);
      }

      .cards-row {
        flex-direction: column;
        gap: 14px;
      }

      .card-crm {
        transform: translateY(20px) scale(0.95);
      }

      .card-crm.is-visible {
        transform: translateY(0) scale(1);
      }

      .card-designer.is-docked {
        width: 300px;
        transform: scale(0.72) translateZ(-30px);
        margin-bottom: 16px;
      }

      .card-designer.is-docked:hover {
        transform: scale(0.74) translateZ(-20px);
      }

      .role-floats {
        display: none;
      }

      .chat-messages {
        height: 300px;
      }

      .crm-fields {
        grid-template-columns: 1fr;
      
      /* Mobile: when CRM appears, gently condense chat so both feel readable */
      .card-chat {
        transition: transform .7s var(--ease), box-shadow .7s var(--ease);
      }
      .card-chat.is-condensed {
        transform: translateY(-2px) scale(0.98);
        box-shadow: var(--shadow-lg);
      }
      .card-chat.is-condensed .chat-messages {
        height: 220px;
        transition: height .7s var(--ease);
      }
}
    }

    @media (max-width: 480px) {
      .card-designer.is-docked {
        width: 260px;
        transform: scale(0.65) translateZ(-30px);
        margin-bottom: 12px;
      }

      .card-designer.is-docked:hover {
        transform: scale(0.67) translateZ(-20px);
      }

      .chat-messages {
        height: 260px;
      }
    }

    /* ========================
       REDUCED MOTION
       ======================== */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <div class="bg-ambient" aria-hidden="true"></div>

  <div class="stack-container">
    <div class="card-stack">

      <!-- CARD 1: ROLE DESIGNER (visible on load) -->
      <div class="glass-card card-designer" id="cardDesigner">
        <!-- Floating role heads -->
        <div class="role-floats" aria-hidden="true">
          <div class="role-float rf-1" data-float="Sales Agent">
            <div class="head">
              <svg viewBox="0 0 24 24"><path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            </div>
            <div class="label">Sales</div>
          </div>
          <div class="role-float rf-2" data-float="Leasing Agent">
            <div class="head">
              <svg viewBox="0 0 24 24"><path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            </div>
            <div class="label">Leasing</div>
          </div>
          <div class="role-float rf-3" data-float="Customer Support">
            <div class="head">
              <svg viewBox="0 0 24 24"><path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            </div>
            <div class="label">Support</div>
          </div>
          <div class="role-float rf-4" data-float="Event Host">
            <div class="head">
              <svg viewBox="0 0 24 24"><path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            </div>
            <div class="label">Events</div>
          </div>
        </div>

        <div class="designer-inner">
          <div class="designer-header">
            <div class="designer-brand">
              <div class="designer-logo">
                <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios" />
              </div>
              <div>
                <div class="designer-title">Design your AI</div>
                <div class="designer-subtitle" id="designerHint">Choose a role to start</div>
              </div>
            </div>
            <div class="live-badge">
              <span class="live-dot"></span>
              Live
            </div>
          </div>

          <div class="role-grid" role="tablist" aria-label="AI role selection">
            <button class="role-btn" data-role="Sales Agent">Sales Agent</button>
            <button class="role-btn" data-role="Leasing Agent">Leasing</button>
            <button class="role-btn" data-role="Customer Support">Support</button>
            <button class="role-btn" data-role="Event Host">Event Host</button>
            <button class="role-btn" data-role="Marketing Coordinator">Marketing</button>
            <button class="role-btn" data-role="Mortgage Advisor">Mortgage</button>
            <button class="role-btn" data-role="Property Concierge">Concierge</button>
            <button class="role-btn" data-role="Operations Admin">Ops Admin</button>
          </div>
        </div>
      </div>

      <!-- CARDS ROW: Chat + CRM side by side (hidden initially) -->
      <div class="cards-row deck stage-select" id="cardsRow">
        <!-- CARD 2: CHAT -->
        <div class="glass-card card-chat" id="cardChat">
          <div class="chat-inner">
            <div class="chat-header">
              <div class="chat-brand">
                <div class="chat-avatar">
                  <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios" />
                </div>
                <div class="chat-meta">
                  <b id="chatTitle">espacios AI</b>
                  <span id="chatRole">Sales Agent</span>
                </div>
              </div>
              <div class="chat-status">
                <span class="status-dot"></span>
                <span id="chatStatus">Online</span>
              </div>
            </div>

            <div class="chat-messages">
              <div class="messages-scroll" id="messagesScroll"></div>
              <div class="compose-bar">
                <div class="compose-input" id="composeInput">Type a message...</div>
                <div class="send-btn">
                  <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CARD 3: CRM -->
        <div class="glass-card card-crm" id="cardCrm">
          <div class="crm-inner">
            <div class="crm-header">
              <div class="crm-title-block">
                <b>CRM Sync</b>
                <span id="crmSubtitle">Waiting for lead data...</span>
              </div>
              <div class="crm-badges">
                <div class="crm-badge" id="badgeHubspot"><span class="badge-dot"></span>HubSpot</div>
                <div class="crm-badge" id="badgeZoho"><span class="badge-dot"></span>Zoho</div>
                <div class="crm-badge" id="badgeBitrix"><span class="badge-dot"></span>Bitrix24</div>
              </div>
            </div>

            <div class="crm-fields">
              <div class="crm-field" id="fieldLead"><b>Lead</b><span>—</span></div>
              <div class="crm-field" id="fieldStage"><b>Stage</b><span>—</span></div>
              <div class="crm-field" id="fieldIntent"><b>Intent</b><span>—</span></div>
              <div class="crm-field" id="fieldBudget"><b>Budget</b><span>—</span></div>
              <div class="crm-field" id="fieldArea"><b>Area</b><span>—</span></div>
              <div class="crm-field" id="fieldNext"><b>Next Step</b><span>—</span></div>
            </div>

            <div class="crm-sync" id="crmSync">
              <div class="sync-chip" id="syncChip">
                <span class="sync-icon"></span>
                <span id="syncText">Idle</span>
              </div>
              <div class="sync-line"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      'use strict';

      const sleep = ms => new Promise(r => setTimeout(r, ms));
      const rand = (min, max) => Math.random() * (max - min) + min;
      const shuffle = arr => arr.sort(() => Math.random() - 0.5);

      // Subtle haptic feedback
      const haptic = (pattern = [8]) => {
        try {
          if (navigator.vibrate) navigator.vibrate(pattern);
        } catch(e) {}
      };

      // Elements
      const cardDesigner = document.getElementById('cardDesigner');
      const cardChat = document.getElementById('cardChat');
      const cardCrm = document.getElementById('cardCrm');
      const cardsRow = document.getElementById('cardsRow');

      
      // Deck behavior: focus one card; other cards peek behind (~75%)
      function setStage(stage){
        if(!cardsRow) return;
        cardsRow.classList.remove('stage-select','stage-chat','stage-crm');
        cardsRow.classList.add(stage);

        [cardDesigner, cardChat, cardCrm].forEach(c=>{
          if(!c) return;
          c.classList.remove('is-peek');
        });

        if(stage === 'stage-select'){
          cardChat?.classList.add('is-peek');
          cardCrm?.classList.add('is-peek');
        } else if(stage === 'stage-chat'){
          cardDesigner?.classList.add('is-peek');
          cardCrm?.classList.add('is-peek');
        } else if(stage === 'stage-crm'){
          cardChat?.classList.add('is-peek');
          cardDesigner?.classList.add('is-peek');
        }
      }

      setStage('stage-select');

      // Optional: tap a peeking card to bring it forward
      cardDesigner?.addEventListener('click', () => setStage('stage-select'));
      cardChat?.addEventListener('click', () => setStage('stage-chat'));
      cardCrm?.addEventListener('click', () => setStage('stage-crm'));
const designerHint = document.getElementById('designerHint');
      const roleButtons = Array.from(document.querySelectorAll('.role-btn'));
      const roleFloats = Array.from(document.querySelectorAll('.role-float'));

      const chatTitle = document.getElementById('chatTitle');
      const chatRole = document.getElementById('chatRole');
      const chatStatus = document.getElementById('chatStatus');
      const messagesScroll = document.getElementById('messagesScroll');
      const composeInput = document.getElementById('composeInput');

      const crmSubtitle = document.getElementById('crmSubtitle');
      const syncChip = document.getElementById('syncChip');
      const syncText = document.getElementById('syncText');
      const crmSync = document.getElementById('crmSync');

      const badges = {
        hubspot: document.getElementById('badgeHubspot'),
        zoho: document.getElementById('badgeZoho'),
        bitrix: document.getElementById('badgeBitrix')
      };

      const fields = {
        lead: document.getElementById('fieldLead'),
        stage: document.getElementById('fieldStage'),
        intent: document.getElementById('fieldIntent'),
        budget: document.getElementById('fieldBudget'),
        area: document.getElementById('fieldArea'),
        next: document.getElementById('fieldNext')
      };

      let runToken = 0;
      let isFlowActive = false;

      // Conversation flows
      const flows = {
        "Sales Agent": [
          { type: "compose", text: "Hi, I'm interested in a 2BR in Dubai Hills." },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Hey! Love that area — quick one so I can shortlist properly: are you buying to live in or invest?" },
          { type: "crm", updates: { stage: "New Lead", intent: "Property Inquiry", area: "Dubai Hills" }, note: "Lead captured" },
          { type: "compose", text: "Investment property." },
          { type: "typing", ms: 1700 },
          { type: "msg", text: "Perfect. What budget range feels right — under 2M, 2–3M, or 3M+?" },
          { type: "crm", updates: { stage: "Qualifying", intent: "Investor" }, note: "Intent updated" },
          { type: "compose", text: "Around 2–3M." },
          { type: "typing", ms: 1800 },
          { type: "msg", text: "Got it. I'll line up 3 options with payment plans + rental estimates. Any preference on view?" },
          { type: "crm", updates: { budget: "AED 2–3M", stage: "Qualified", next: "Send 3 options" }, note: "Budget captured" },
        ],

        "Leasing Agent": [
          { type: "compose", text: "Hello, I'm looking for a 1BR in Business Bay." },
          { type: "typing", ms: 1500 },
          { type: "msg", text: "Sure thing! When are you planning to move in?" },
          { type: "crm", updates: { stage: "New Lead", intent: "Rental Inquiry", area: "Business Bay" }, note: "Lead created" },
          { type: "compose", text: "Next month ideally." },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Great timing. What monthly budget should I work within — 7–9k, 9–12k, or 12k+?" },
          { type: "crm", updates: { stage: "Qualifying", next: "Confirm budget" }, note: "Timeline captured" },
          { type: "compose", text: "9–12k works." },
          { type: "typing", ms: 1700 },
          { type: "msg", text: "Perfect. Any must-haves? Balcony, metro walk, furnished?" },
          { type: "crm", updates: { budget: "AED 9–12k/mo", stage: "Qualified" }, note: "Budget captured" },
        ],

        "Customer Support": [
          { type: "compose", text: "Hi, I didn't receive the brochure you promised." },
          { type: "typing", ms: 1400 },
          { type: "msg", text: "I've got you. Can you share the phone number you used so I can resend it?" },
          { type: "crm", updates: { stage: "Support Ticket", intent: "Brochure Resend", next: "Verify + resend" }, note: "Ticket created" },
          { type: "compose", text: "+971 5X XXX XXXX" },
          { type: "typing", ms: 1500 },
          { type: "msg", text: "Thanks! Resending now — I'll also attach a backup PDF here." },
          { type: "crm", updates: { stage: "Resolved", next: "Confirm delivery" }, note: "Status updated" },
        ],

        "Event Host": [
          { type: "compose", text: "Is there a property show this weekend?" },
          { type: "typing", ms: 1400 },
          { type: "msg", text: "Yes! How many guests will you be bringing?" },
          { type: "crm", updates: { stage: "RSVP", intent: "Event Inquiry", next: "Guest count + time" }, note: "RSVP created" },
          { type: "compose", text: "Just 2 of us." },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Perfect. Afternoon or evening slot?" },
          { type: "crm", updates: { stage: "Qualifying", next: "Confirm timeslot" }, note: "Guest count captured" },
          { type: "compose", text: "Evening please." },
          { type: "typing", ms: 1700 },
          { type: "msg", text: "Done! I'll send location + parking details shortly." },
          { type: "crm", updates: { stage: "Confirmed", next: "Send location" }, note: "RSVP confirmed" },
        ],

        "Marketing Coordinator": [
          { type: "compose", text: "Can you help follow up on yesterday's campaign leads?" },
          { type: "typing", ms: 1500 },
          { type: "msg", text: "Absolutely. Soft check-in or direct offer message?" },
          { type: "crm", updates: { stage: "Workflow", intent: "Lead Follow-up", next: "Pick tone" }, note: "Workflow started" },
          { type: "compose", text: "Soft check-in." },
          { type: "typing", ms: 1700 },
          { type: "msg", text: "Got it. I'll send a gentle message with one qualifying question. Which project should I prioritize?" },
          { type: "crm", updates: { stage: "In Progress", next: "Confirm project" }, note: "Tone set" },
        ],

        "Mortgage Advisor": [
          { type: "compose", text: "Can I qualify for a home loan in Dubai?" },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Let's find out! Are you salaried or self-employed?" },
          { type: "crm", updates: { stage: "New Lead", intent: "Mortgage Inquiry", next: "Income profile" }, note: "Lead created" },
          { type: "compose", text: "Salaried." },
          { type: "typing", ms: 1700 },
          { type: "msg", text: "Great. What's your approximate monthly income, and do you prefer fixed or variable rates?" },
          { type: "crm", updates: { stage: "Qualifying", next: "Rate preference" }, note: "Profile captured" },
        ],

        "Property Concierge": [
          { type: "compose", text: "We're relocating to Dubai — can you help shortlist areas?" },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Of course! Are you prioritizing commute, schools, or lifestyle?" },
          { type: "crm", updates: { stage: "New Lead", intent: "Relocation", next: "Capture priorities" }, note: "Request created" },
          { type: "compose", text: "Schools + quiet neighborhoods." },
          { type: "typing", ms: 1800 },
          { type: "msg", text: "Perfect. What's your budget range and bedroom requirement?" },
          { type: "crm", updates: { stage: "Qualifying", next: "Budget + bedrooms" }, note: "Priorities captured" },
        ],

        "Operations Admin": [
          { type: "compose", text: "Can you log today's WhatsApp inquiries into the CRM?" },
          { type: "typing", ms: 1400 },
          { type: "msg", text: "On it. I'll tag by intent and assign next steps. Who gets Dubai Hills leads?" },
          { type: "crm", updates: { stage: "Ops Task", intent: "Data Entry", next: "Confirm routing" }, note: "Workflow started" },
          { type: "compose", text: "Assign to Nadia." },
          { type: "typing", ms: 1600 },
          { type: "msg", text: "Done. Dubai Hills → Nadia. Pipeline is clean with stage + notes." },
          { type: "crm", updates: { stage: "Rules Saved", next: "Auto-route active" }, note: "Rules applied" },
        ],
      };

      // Helper: create element
      function el(tag, cls) {
        const n = document.createElement(tag);
        if (cls) n.className = cls;
        return n;
      }

      // Reset all state
      function resetState() {
        // Reset cards
        cardDesigner.classList.remove('is-docked');
        cardsRow.classList.remove('is-visible');
        cardCrm.classList.remove('is-visible', 'is-active');

        // Reset messages
        messagesScroll.innerHTML = '';

        // Reset CRM badges
        Object.values(badges).forEach(b => {
          b.classList.remove('is-visible', 'is-active');
        });

        // Reset CRM fields
        Object.values(fields).forEach(f => {
          f.querySelector('span').textContent = '—';
          f.classList.remove('is-updated');
        });

        // Reset sync
        crmSync.classList.remove('is-syncing');
        syncChip.classList.remove('is-syncing');
        syncText.textContent = 'Idle';
        crmSubtitle.textContent = 'Waiting for lead data...';

        // Reset compose
        composeInput.textContent = 'Type a message...';

        // Reset role buttons
        roleButtons.forEach(b => b.classList.remove('is-active'));

        // Reset floats
        roleFloats.forEach(f => f.classList.remove('is-highlighted'));
      }

      // Scroll messages to bottom
      function scrollToBottom() {
        messagesScroll.scrollTop = messagesScroll.scrollHeight;
      }

      // Add bubble
      function addBubble(from, text) {
        const row = el('div', 'bubble-row');
        const bub = el('div', 'bubble ' + (from === 'user' ? 'user' : 'ai'));
        bub.textContent = text;
        row.appendChild(bub);
        messagesScroll.appendChild(row);
        scrollToBottom();
        return { row, bubble: bub };
      }

      // Typing indicator
      let typingEl = null;

      function showTyping(on) {
        if (on && !typingEl) {
          const row = el('div', 'typing-row');
          const indicator = el('div', 'typing-indicator');
          indicator.appendChild(el('span', 'typing-dot'));
          indicator.appendChild(el('span', 'typing-dot'));
          indicator.appendChild(el('span', 'typing-dot'));
          row.appendChild(indicator);
          messagesScroll.appendChild(row);
          typingEl = { row, indicator };
          requestAnimationFrame(() => indicator.classList.add('is-visible'));
          scrollToBottom();
        } else if (!on && typingEl) {
          typingEl.indicator.classList.remove('is-visible');
          const r = typingEl.row;
          setTimeout(() => r.remove(), 250);
          typingEl = null;
        }
      }

      // Compose input typing effect
      async function typeInCompose(text, token) {
        composeInput.textContent = '';
        for (let i = 0; i < text.length; i++) {
          if (token !== runToken) return;
          composeInput.textContent = text.slice(0, i + 1);
          await sleep(25 + rand(15, 30));
        }
        await sleep(300 + rand(100, 200));
      }

      // Flash CRM field
      function flashField(key) {
        const f = fields[key];
        if (!f) return;
        f.classList.remove('is-updated');
        void f.offsetWidth; // force reflow
        f.classList.add('is-updated');
        setTimeout(() => f.classList.remove('is-updated'), 1300);
      }

      // Update CRM field
      function updateCRMField(key, value) {
        const f = fields[key];
        if (!f) return;
        f.querySelector('span').textContent = value;
        flashField(key);
      }

      // Staggered random CRM badge reveal
      async function revealBadgesRandomly(token) {
        const badgeKeys = shuffle(['hubspot', 'zoho', 'bitrix']);
        
        for (const key of badgeKeys) {
          if (token !== runToken) return;
          await sleep(rand(180, 380));
          badges[key].classList.add('is-visible');
        }
      }

      // Activate random CRM badge
      function activateRandomBadge() {
        const activeKeys = Object.keys(badges).filter(k => badges[k].classList.contains('is-visible'));
        if (activeKeys.length === 0) return;
        
        // Deactivate all
        Object.values(badges).forEach(b => b.classList.remove('is-active'));
        
        // Activate random one
        const chosen = activeKeys[Math.floor(Math.random() * activeKeys.length)];
        badges[chosen].classList.add('is-active');
      }

      // Set sync state
      function setSyncing(on, text) {
        if (on) {
          crmSync.classList.add('is-syncing');
          syncChip.classList.add('is-syncing');
          syncText.textContent = text || 'Syncing...';
        } else {
          crmSync.classList.remove('is-syncing');
          syncChip.classList.remove('is-syncing');
          syncText.textContent = text || 'Synced';
        }
      }

      // Apply CRM updates
      async function applyCRMUpdates(updates, note, token) {
        if (token !== runToken) return;

        setSyncing(true, 'Syncing...');
        activateRandomBadge();
        crmSubtitle.textContent = note || 'Processing...';

        // Sequential field updates with small delays
        const keys = Object.keys(updates);
        for (const key of keys) {
          if (token !== runToken) return;
          await sleep(rand(150, 300));
          updateCRMField(key, updates[key]);
          haptic([6]);
        }

        await sleep(600);
        setSyncing(false, 'Synced');
      }

      // Highlight matching float
      function highlightFloat(role) {
        roleFloats.forEach(f => {
          const match = f.dataset.float === role;
          f.classList.toggle('is-highlighted', match);
        });
      }

      // Main flow runner
      async function runFlow(role) {
        const token = ++runToken;
        isFlowActive = true;

        resetState();

        // Set active button
        roleButtons.forEach(b => {
          b.classList.toggle('is-active', b.dataset.role === role);
        });

        highlightFloat(role);
        designerHint.textContent = role;

        await sleep(300);

        // Phase 1: Dock the designer card, show cards row with chat
        cardDesigner.classList.add('is-docked');
        
        await sleep(150);
        
        cardsRow.classList.add('is-visible');
        chatRole.textContent = role;

        await sleep(600);

        const steps = flows[role] || [];
        let crmRevealed = false;

        for (const step of steps) {
          if (token !== runToken) return;

          if (step.type === 'compose') {
            await typeInCompose(step.text, token);
            if (token !== runToken) return;
            addBubble('user', step.text);
            composeInput.textContent = 'Type a message...';
            haptic([6]);
            await sleep(700 + rand(200, 400));
          }

          if (step.type === 'typing') {
            showTyping(true);
            await sleep(step.ms || 1500);
            showTyping(false);
            await sleep(200);
          }

          if (step.type === 'msg') {
            addBubble('ai', step.text);
            await sleep(800 + rand(200, 400));
          }

          if (step.type === 'crm') {
            // Phase 2: Reveal CRM card on first CRM event
            if (!crmRevealed) {
              crmRevealed = true;
              
              cardCrm.classList.add('is-visible');
              setStage('stage-crm');

              // Mobile: keep the chat readable, then bring CRM in gently
              if (window.matchMedia && window.matchMedia('(max-width: 800px)').matches) {
                cardChat.classList.add('is-condensed');
                setTimeout(() => {
                  try { cardCrm.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch(e) {}
                }, 350);
              }
              
              // Set initial lead name
              fields.lead.querySelector('span').textContent = 'New WhatsApp Lead';
              flashField('lead');

              // Staggered badge reveal
              revealBadgesRandomly(token);

              await sleep(600);
            }

            await applyCRMUpdates(step.updates, step.note, token);
            await sleep(700);
          }
        }

        // Flow complete
        designerHint.textContent = role + ' • ready';
        isFlowActive = false;
      }

      // Click on docked designer to switch roles
      cardDesigner.addEventListener('click', (e) => {
        if (!cardDesigner.classList.contains('is-docked')) return;
        
        // Undock and reset
        runToken++;
        isFlowActive = false;
        resetState();
        designerHint.textContent = 'Choose a role to start';
      });

      // Role button clicks
      roleButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (isFlowActive && btn.classList.contains('is-active')) return;
          
          haptic([8]);
          const role = btn.dataset.role;
          runFlow(role);
        });
      });

      // Init: everything is already in correct initial state via CSS
    })();
  </script>
</body>
</html>


/* ===== FILE: bigsquareanomation.html ===== */
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>espacios — Simulation (One Card at a Time)</title>
  <meta name="description" content="espacios simulation: WhatsApp conversation → CRM sync. One card at a time, role-based flows, industry-accurate CRM modes." />
  <style>
    :root{
      --page-bg:#E6E9ED;
      --text:rgba(15,15,16,.90);
      --muted:rgba(90,90,90,.88);

      --glass-bg:rgba(255,255,255,.32);
      --glass-border:rgba(255,255,255,.58);
      --glass-blur:20px;

      --shadow-xl:0 45px 120px rgba(0,0,0,.12),0 18px 50px rgba(0,0,0,.08);
      --shadow-lg:0 28px 70px rgba(0,0,0,.10),0 10px 30px rgba(0,0,0,.06);
      --shadow-md:0 16px 40px rgba(0,0,0,.08);
      --shadow-sm:0 8px 24px rgba(0,0,0,.05);

      --accent:#B6FF3B;
      --accent-glow:rgba(182,255,59,.5);

      --radius:28px;
      --radius-sm:18px;
      --pill:999px;

      --ease:cubic-bezier(.16,1,.3,1);
      --ease-out:cubic-bezier(.0,0,.2,1);

      --font:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Display","Inter",sans-serif;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      font-family:var(--font);
      color:var(--text);
      background:var(--page-bg);
      min-height:100vh;
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      perspective:1400px;
    }

    /* Ambient background (subtle movement) */
    .bg-ambient{
      position:fixed;
      inset:-35vh -35vw;
      pointer-events:none;
      z-index:-1;
      background:
        radial-gradient(1000px 600px at 10% 15%, rgba(182,255,59,.10), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(147,197,253,.14), transparent 55%),
        radial-gradient(800px 450px at 50% 85%, rgba(196,181,253,.12), transparent 55%),
        radial-gradient(1400px 800px at 50% 50%, rgba(255,255,255,.55), transparent 65%),
        linear-gradient(165deg, #EEF1F5 0%, #E4E7EB 45%, #D9DEE4 100%);
      animation:ambientDrift 22s ease-in-out infinite;
    }
    @keyframes ambientDrift{
      0%,100%{transform:translate3d(0,0,0) scale(1) rotate(0deg)}
      33%{transform:translate3d(-1.2%,-0.8%,0) scale(1.012) rotate(.4deg)}
      66%{transform:translate3d(.8%,-1.2%,0) scale(1.018) rotate(-.3deg)}
    }

    .stack-container{
      position:relative;
      width:100%;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 20px;
    }

    /* ===== Deck (one card at a time) ===== */
    .deck{
      position:relative;
      width:min(980px, 100%);
      height: 680px;
      max-height: calc(100vh - 120px);
    }
    @media (max-width: 900px){
      .deck{ height: 720px; }
    }
    @media (max-width: 520px){
      .deck{ height: 760px; }
    }

    .glass-card{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      background:var(--glass-bg);
      border:1px solid var(--glass-border);
      border-radius:var(--radius);
      box-shadow:var(--shadow-lg);
      backdrop-filter: blur(var(--glass-blur)) saturate(1.5);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(1.5);
      overflow:hidden;
      transform-origin:center top;
      will-change: transform, opacity, filter, box-shadow;
      transition:
        transform .95s var(--ease),
        opacity .95s var(--ease),
        filter .95s var(--ease),
        box-shadow .8s var(--ease);
    }

    /* Sheen */
    .glass-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:var(--radius);
      background:linear-gradient(135deg,
        rgba(255,255,255,.55) 0%,
        rgba(255,255,255,.12) 28%,
        rgba(147,197,253,.08) 45%,
        rgba(182,255,59,.06) 55%,
        rgba(196,181,253,.08) 70%,
        rgba(255,255,255,.35) 100%
      );
      opacity:.75;
      pointer-events:none;
      animation:holoSheen 9s ease-in-out infinite;
    }
    @keyframes holoSheen{ 0%,100%{opacity:.6} 50%{opacity:.85} }

    /* Inner highlight */
    .glass-card::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:var(--radius);
      pointer-events:none;
      box-shadow: inset 0 1px 1px rgba(255,255,255,.7),
                  inset 0 -1px 1px rgba(15,15,16,.03);
    }
    .glass-card > *{ position:relative; z-index:2; }

    .deck .glass-card.is-behind{
      opacity:.88;
      filter:saturate(.98);
      pointer-events:auto;
      cursor:pointer;
    }

    /* Stages */
    .deck.stage-designer #cardDesigner{
      z-index:30;
      transform: translateY(0) scale(1);
      opacity:1;
      pointer-events:auto;
      cursor:default;
      box-shadow:var(--shadow-xl);
    }
    .deck.stage-designer #cardChat{
      z-index:20;
      transform: translateY(26px) scale(.965);
      opacity:.92;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-lg);
    }
    .deck.stage-designer #cardCrm{
      z-index:10;
      transform: translateY(52px) scale(.935);
      opacity:.86;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-md);
    }

    .deck.stage-chat #cardChat{
      z-index:30;
      transform: translateY(0) scale(1);
      opacity:1;
      pointer-events:auto;
      cursor:default;
      box-shadow:var(--shadow-xl);
    }
    .deck.stage-chat #cardDesigner{
      z-index:20;
      transform: translateY(26px) scale(.965);
      opacity:.92;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-lg);
    }
    .deck.stage-chat #cardCrm{
      z-index:10;
      transform: translateY(52px) scale(.935);
      opacity:.86;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-md);
    }

    .deck.stage-crm #cardCrm{
      z-index:30;
      transform: translateY(0) scale(1);
      opacity:1;
      pointer-events:auto;
      cursor:default;
      box-shadow:var(--shadow-xl);
    }
    .deck.stage-crm #cardChat{
      z-index:20;
      transform: translateY(26px) scale(.965);
      opacity:.92;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-lg);
    }
    .deck.stage-crm #cardDesigner{
      z-index:10;
      transform: translateY(52px) scale(.935);
      opacity:.86;
      pointer-events:auto;
      cursor:pointer;
      box-shadow:var(--shadow-md);
    }

    /* ===== Designer card ===== */
    .designer{
      padding:18px;
      height:100%;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .designer-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-radius:20px;
      background:rgba(255,255,255,.48);
      border:1px solid rgba(255,255,255,.6);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .brand-logo{
      width:34px;height:34px;border-radius:10px;
      background:rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.7);
      padding:6px;
      display:grid;place-items:center;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      flex: 0 0 auto;
    }
    .brand-logo img{ width:100%;height:100%;object-fit:contain; }
    .brand-meta{ min-width:0; }
    .brand-meta b{
      display:block;
      font-size:14px;
      font-weight:800;
      letter-spacing:-0.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand-meta span{
      display:block;
      font-size:11px;
      color:var(--muted);
      margin-top:1px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 11px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.45);
      border:1px solid rgba(255,255,255,.6);
      font-size:11px;
      font-weight:650;
      color:var(--muted);
      flex: 0 0 auto;
    }
    .pill-dot{
      width:7px;height:7px;border-radius:var(--pill);
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(182,255,59,.18), 0 0 14px rgba(182,255,59,.35);
      animation:pulse 2.2s ease-in-out infinite;
    }
    @keyframes pulse{ 0%,100%{transform:scale(1);opacity:.85} 50%{transform:scale(1.18);opacity:1} }

    .role-grid{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding:12px;
      border-radius:20px;
      background:rgba(255,255,255,.32);
      border:1px solid rgba(255,255,255,.5);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:auto;
    }

    .role-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.6);
      background:rgba(255,255,255,.48);
      color:rgba(15,15,16,.78);
      border-radius:var(--pill);
      padding:10px 14px;
      font-size:12px;
      font-weight:700;
      letter-spacing:-0.01em;
      cursor:pointer;
      transition: transform .3s var(--ease), box-shadow .3s var(--ease), background .3s var(--ease), border-color .3s var(--ease);
      box-shadow:var(--shadow-sm);
      user-select:none;
      white-space:nowrap;
    }
    .role-btn:hover{ transform:translateY(-2px); box-shadow:var(--shadow-md); background:rgba(255,255,255,.58); }
    .role-btn.is-active{
      border-color:rgba(182,255,59,.5);
      background:linear-gradient(135deg, rgba(182,255,59,.28), rgba(255,255,255,.52));
      color:rgba(15,15,16,.92);
      box-shadow:0 18px 45px rgba(182,255,59,.16), var(--shadow-md);
    }

    .designer-foot{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-radius:22px;
      background:rgba(255,255,255,.28);
      border:1px solid rgba(255,255,255,.45);
    }
    .hint{
      font-size:12px;
      color:rgba(15,15,16,.70);
      line-height:1.35;
    }
    .reset-btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.6);
      background:rgba(255,255,255,.46);
      border-radius:var(--pill);
      padding:10px 14px;
      font-size:12px;
      font-weight:750;
      color:rgba(15,15,16,.78);
      box-shadow:var(--shadow-sm);
      cursor:pointer;
      transition: transform .25s var(--ease), box-shadow .25s var(--ease), background .25s var(--ease);
      white-space:nowrap;
    }
    .reset-btn:hover{ transform:translateY(-2px); box-shadow:var(--shadow-md); background:rgba(255,255,255,.56); }

    /* ===== Chat card ===== */
    .chat{
      height:100%;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .chat-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-radius:20px;
      background:rgba(255,255,255,.48);
      border:1px solid rgba(255,255,255,.6);
    }
    .chat-brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .chat-avatar{
      width:32px;height:32px;border-radius:var(--pill);
      background:rgba(255,255,255,.6);
      border:1px solid rgba(255,255,255,.7);
      padding:5px;
      display:grid;place-items:center;
      flex:0 0 auto;
    }
    .chat-avatar img{ width:100%;height:100%;object-fit:contain; }
    .chat-meta{ min-width:0; }
    .chat-meta b{
      display:block;
      font-size:12px;
      font-weight:800;
      letter-spacing:-0.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chat-meta span{
      display:block;
      font-size:11px;
      color:var(--muted);
      margin-top:1px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chat-status{
      display:flex;
      align-items:center;
      gap:7px;
      font-size:11px;
      color:var(--muted);
      flex:0 0 auto;
    }
    .status-dot{
      width:7px;height:7px;border-radius:var(--pill);
      background:rgba(37,211,102,.9);
      box-shadow:0 0 0 3px rgba(37,211,102,.15), 0 0 10px rgba(37,211,102,.3);
    }

    .chat-messages{
      flex:1;
      border-radius:22px;
      background:rgba(255,255,255,.25);
      border:1px solid rgba(255,255,255,.52);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      position:relative;
    }

    /* AI active glow (only during typing/new AI message) */
    .chat-messages.ai-glow::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(650px 320px at 15% 30%, rgba(37,211,102,.22), transparent 55%),
        radial-gradient(560px 280px at 85% 75%, rgba(182,255,59,.16), transparent 60%);
      filter: blur(18px);
      opacity: .0;
      transform: translateY(8px);
      animation: aiGlow 1.1s var(--ease) forwards;
      pointer-events:none;
    }
    @keyframes aiGlow{
      0%{opacity:0; transform:translateY(10px)}
      40%{opacity:.85; transform:translateY(0)}
      100%{opacity:0; transform:translateY(-6px)}
    }

    .messages-scroll{
      flex:1;
      padding:14px;
      overflow-y:auto;
      scrollbar-width:none;
    }
    .messages-scroll::-webkit-scrollbar{ display:none; }

    .bubble-row{ display:flex; margin:8px 0; }
    .bubble{
      max-width:82%;
      padding:10px 13px;
      border-radius:16px;
      font-size:13px;
      line-height:1.45;
      letter-spacing:-0.01em;
      opacity:0;
      transform:translateY(10px) scale(.97);
      animation:bubbleIn .55s var(--ease) forwards;
      white-space:pre-wrap;
    }
    .bubble.user{
      margin-left:auto;
      background:linear-gradient(135deg, rgba(220,248,198,.65), rgba(220,248,198,.42));
      border:1px solid rgba(37,211,102,.15);
      color:rgba(15,15,16,.88);
    }
    .bubble.ai{
      margin-right:auto;
      background:rgba(255,255,255,.62);
      border:1px solid rgba(255,255,255,.55);
      color:rgba(15,15,16,.88);
    }
    @keyframes bubbleIn{ to{opacity:1; transform:translateY(0) scale(1)} }

    .typing-row{ display:flex; margin:10px 0; }
    .typing-indicator{
      margin-right:auto;
      padding:10px 14px;
      border-radius:16px;
      background:rgba(255,255,255,.58);
      border:1px solid rgba(255,255,255,.55);
      display:flex;
      gap:5px;
      align-items:center;
      opacity:0;
      transform:translateY(8px);
      transition: opacity .35s var(--ease), transform .35s var(--ease);
    }
    .typing-indicator.is-visible{ opacity:1; transform:translateY(0); }
    .typing-dot{
      width:6px;height:6px;border-radius:var(--pill);
      background:rgba(15,15,16,.35);
      animation:typingBounce 1.3s ease-in-out infinite;
    }
    .typing-dot:nth-child(2){ animation-delay:.15s }
    .typing-dot:nth-child(3){ animation-delay:.3s }
    @keyframes typingBounce{
      0%,100%{transform:translateY(0);opacity:.35}
      50%{transform:translateY(-4px);opacity:.8}
    }

    .compose-bar{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.45);
      background:rgba(255,255,255,.25);
      display:flex;
      gap:10px;
      align-items:center;
    }
    .compose-input{
      flex:1;
      height:40px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.5);
      border:1px solid rgba(255,255,255,.65);
      box-shadow:var(--shadow-sm);
      display:flex;
      align-items:center;
      padding:0 14px;
      font-size:12px;
      color:rgba(15,15,16,.55);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .send-btn{
      width:42px;height:42px;border-radius:var(--pill);
      border:1px solid rgba(182,255,59,.45);
      background:linear-gradient(135deg, rgba(182,255,59,.6), rgba(255,255,255,.38));
      box-shadow:0 14px 35px rgba(182,255,59,.16), var(--shadow-md);
      display:grid;place-items:center;
      flex: 0 0 auto;
    }
    .send-btn svg{ width:18px;height:18px; fill:rgba(15,15,16,.85); }

    /* ===== CRM card ===== */
    .crm{
      height:100%;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .crm-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,.45);
    }
    .crm-title b{
      display:block;
      font-size:13px;
      font-weight:850;
      letter-spacing:-0.01em;
    }
    .crm-title span{
      display:block;
      font-size:11px;
      color:var(--muted);
      margin-top:1px;
    }
    .crm-brand{
      display:flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.48);
      border:1px solid rgba(255,255,255,.62);
      font-size:10px;
      font-weight:800;
      color:rgba(15,15,16,.68);
      box-shadow:var(--shadow-sm);
      white-space:nowrap;
      flex: 0 0 auto;
      max-width: 52%;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .crm-brand img{ width:16px;height:16px; object-fit:contain; }

    .crm-fields{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 2px;
      overflow:auto;
      padding-right: 2px;
    }
    @media (max-width: 620px){
      .crm-fields{ grid-template-columns: 1fr; }
    }

    .crm-field{
      padding:10px 12px;
      border-radius:var(--radius-sm);
      background:rgba(255,255,255,.45);
      border:1px solid rgba(255,255,255,.58);
      box-shadow:var(--shadow-sm);
      position:relative;
      overflow:hidden;
      transition: transform .4s var(--ease), box-shadow .4s var(--ease), border-color .3s var(--ease);
      min-height: 56px;
    }
    .crm-field.is-updated{
      transform:translateY(-2px);
      border-color:rgba(182,255,59,.45);
      box-shadow:0 18px 45px rgba(182,255,59,.14), var(--shadow-md);
    }
    .crm-field.is-updated::after{
      content:"";
      position:absolute;
      inset:-50%;
      background:radial-gradient(circle at 30% 30%, rgba(182,255,59,.25), transparent 60%);
      filter:blur(14px);
      opacity:.85;
      animation:fieldFlash 1.1s var(--ease) forwards;
    }
    @keyframes fieldFlash{
      0%{opacity:.85; transform:translateX(-8%) translateY(-8%)}
      100%{opacity:0; transform:translateX(8%) translateY(8%)}
    }
    .crm-field b{
      display:block;
      font-size:10px;
      font-weight:800;
      letter-spacing:.03em;
      text-transform:uppercase;
      color:rgba(15,15,16,.52);
      margin-bottom:3px;
    }
    .crm-field span{
      display:block;
      font-size:12px;
      font-weight:800;
      letter-spacing:-0.01em;
      color:rgba(15,15,16,.85);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .crm-sync{
      margin-top:auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding-top: 10px;
      color:var(--muted);
      font-size:11px;
    }
    .sync-chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:7px 11px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.45);
      border:1px solid rgba(255,255,255,.6);
      transition:border-color .3s, box-shadow .3s;
    }
    .sync-chip.is-syncing{
      border-color:rgba(182,255,59,.4);
      box-shadow:0 0 0 3px rgba(182,255,59,.1), 0 0 18px rgba(182,255,59,.15);
    }
    .sync-icon{
      width:16px;height:16px;border-radius:var(--pill);
      background:rgba(15,15,16,.1);
      position:relative;
      overflow:hidden;
      transition:background .3s, box-shadow .3s;
    }
    .sync-chip.is-syncing .sync-icon{
      background:rgba(182,255,59,.25);
      box-shadow:0 0 0 3px rgba(182,255,59,.12), 0 0 14px rgba(182,255,59,.25);
    }
    .sync-icon::after{
      content:"";
      position:absolute;
      inset:-30%;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), transparent 60%);
      filter:blur(4px);
      opacity:.55;
    }
    .sync-line{
      flex:1;
      height:2px;
      border-radius:var(--pill);
      background:linear-gradient(90deg, transparent, rgba(182,255,59,.5), transparent);
      opacity:0;
      transition:opacity .4s;
    }
    .crm-sync.is-syncing .sync-line{
      opacity:.85;
      animation:syncSweep 1.4s ease-in-out infinite;
    }
    @keyframes syncSweep{
      0%,100%{transform:translateX(-10%)}
      50%{transform:translateX(10%)}
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *,*::before,*::after{
        animation-duration:.01ms !important;
        animation-iteration-count:1 !important;
        transition-duration:.01ms !important;
      }
    }
  </style>
</head>
<body>
  <div class="bg-ambient" aria-hidden="true"></div>

  <div class="stack-container">
    <div class="deck stage-designer" id="deck">

      <!-- CARD 1: DESIGNER -->
      <div class="glass-card" id="cardDesigner" aria-label="Designer card">
        <div class="designer">
          <div class="designer-top">
            <div class="brand">
              <div class="brand-logo" title="espacios">
                <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espacios logo">
              </div>
              <div class="brand-meta">
                <b>Design your AI</b>
                <span id="designerHint">Choose a role to start</span>
              </div>
            </div>
            <div class="pill"><span class="pill-dot"></span>Live</div>
          </div>

          <div class="role-grid" role="tablist" aria-label="AI role selection">
            <!-- Real estate + ops -->
            <button class="role-btn" data-role="Sales Agent">Sales Agent</button>
            <button class="role-btn" data-role="Leasing Agent">Leasing Agent</button>
            <button class="role-btn" data-role="Property Concierge">Property Concierge</button>
            <button class="role-btn" data-role="Mortgage Advisor">Mortgage Advisor</button>
            <button class="role-btn" data-role="Operations Admin">Operations Admin</button>

            <!-- Support + events + marketing -->
            <button class="role-btn" data-role="Customer Support">Customer Support</button>
            <button class="role-btn" data-role="Event Host">Event Host</button>
            <button class="role-btn" data-role="Marketing Coordinator">Marketing Coordinator</button>

            <!-- Commerce -->
            <button class="role-btn" data-role="Order Assistant (Shopify)">Order Assistant (Shopify)</button>
            <button class="role-btn" data-role="Restaurant Orders">Restaurant Orders</button>

            <!-- Appointments + bookings -->
            <button class="role-btn" data-role="Appointment Booker">Appointment Booker</button>
            <button class="role-btn" data-role="Hotel Booking">Hotel Booking</button>
          </div>

          <div class="designer-foot">
            <div class="hint" id="designerFootHint">
              Pick a role, then watch WhatsApp capture details and sync the right CRM model.
            </div>
            <button class="reset-btn" id="resetBtn">Reset</button>
          </div>
        </div>
      </div>

      <!-- CARD 2: CHAT (WhatsApp) -->
      <div class="glass-card" id="cardChat" aria-label="Chat card">
        <div class="chat">
          <div class="chat-header">
            <div class="chat-brand">
              <div class="chat-avatar" title="WhatsApp">
                <img id="chatAvatarImg" src="https://cdn.simpleicons.org/whatsapp/25D366" alt="WhatsApp logo">
              </div>
              <div class="chat-meta">
                <b id="chatTitle">WhatsApp AI</b>
                <span id="chatRole">—</span>
              </div>
            </div>
            <div class="chat-status">
              <span class="status-dot"></span>
              <span id="chatStatus">Online</span>
            </div>
          </div>

          <div class="chat-messages" id="chatMessagesBox">
            <div class="messages-scroll" id="messagesScroll"></div>
            <div class="compose-bar">
              <div class="compose-input" id="composeInput">Type a message...</div>
              <div class="send-btn" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CARD 3: CRM -->
      <div class="glass-card" id="cardCrm" aria-label="CRM card">
        <div class="crm">
          <div class="crm-header">
            <div class="crm-title">
              <b id="crmTitle">CRM</b>
              <span id="crmSubtitle">Waiting for lead data...</span>
            </div>
            <div class="crm-brand" id="crmBrandChip" title="CRM platform">
              <img id="crmBrandLogo" src="https://cdn.simpleicons.org/hubspot/FF7A59" alt="CRM logo">
              <span id="crmBrandName">HubSpot</span>
            </div>
          </div>

          <div class="crm-fields" id="crmFields"></div>

          <div class="crm-sync" id="crmSync">
            <div class="sync-chip" id="syncChip">
              <span class="sync-icon"></span>
              <span id="syncText">Idle</span>
            </div>
            <div class="sync-line"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    (function(){
      'use strict';

      const sleep = (ms)=>new Promise(r=>setTimeout(r, ms));
      const rand = (min,max)=>Math.random()*(max-min)+min;

      const haptic = (pattern=[8])=>{
        try{ if(navigator.vibrate) navigator.vibrate(pattern); }catch(e){}
      };

      // Elements
      const deck = document.getElementById('deck');
      const cardDesigner = document.getElementById('cardDesigner');
      const cardChat = document.getElementById('cardChat');
      const cardCrm = document.getElementById('cardCrm');

      const designerHint = document.getElementById('designerHint');
      const designerFootHint = document.getElementById('designerFootHint');
      const resetBtn = document.getElementById('resetBtn');
      const roleButtons = Array.from(document.querySelectorAll('.role-btn'));

      const chatRole = document.getElementById('chatRole');
      const messagesScroll = document.getElementById('messagesScroll');
      const composeInput = document.getElementById('composeInput');
      const chatMessagesBox = document.getElementById('chatMessagesBox');

      const crmTitle = document.getElementById('crmTitle');
      const crmSubtitle = document.getElementById('crmSubtitle');
      const crmBrandLogo = document.getElementById('crmBrandLogo');
      const crmBrandName = document.getElementById('crmBrandName');
      const crmFields = document.getElementById('crmFields');

      const crmSync = document.getElementById('crmSync');
      const syncChip = document.getElementById('syncChip');
      const syncText = document.getElementById('syncText');

      // Stage control
      function setStage(stage){
        deck.classList.remove('stage-designer','stage-chat','stage-crm');
        deck.classList.add(stage);
      }

      // Click behind cards to bring forward (one card at a time)
      cardDesigner.addEventListener('click', ()=> setStage('stage-designer'));
      cardChat.addEventListener('click', ()=> setStage('stage-chat'));
      cardCrm.addEventListener('click', ()=> setStage('stage-crm'));

      // CRM modes (industry-accurate)
      const CRM_MODES = {
        pipeline: {
          title: 'Pipeline CRM',
          brand: { name: 'HubSpot', logo: 'https://cdn.simpleicons.org/hubspot/FF7A59' },
          fields: [
            ['lead','Lead'],
            ['stage','Stage'],
            ['intent','Intent'],
            ['budget','Budget'],
            ['area','Area'],
            ['next','Next Step'],
          ]
        },
        rental: {
          title: 'Leasing CRM',
          brand: { name: 'Zoho CRM', logo: 'https://cdn.simpleicons.org/zoho/EA4335' },
          fields: [
            ['lead','Tenant'],
            ['stage','Status'],
            ['area','Area'],
            ['budget','Budget'],
            ['movein','Move-in'],
            ['next','Next Step'],
          ]
        },
        ticket: {
          title: 'Support Desk',
          brand: { name: 'Zendesk', logo: 'https://cdn.simpleicons.org/zendesk/03363D' },
          fields: [
            ['ticket','Ticket'],
            ['issue','Issue'],
            ['priority','Priority'],
            ['status','Status'],
            ['assigned','Assigned'],
            ['next','Next Step'],
          ]
        },
        rsvp: {
          title: 'Event RSVP',
          brand: { name: 'RSVP CRM', logo: 'https://cdn.simpleicons.org/eventbrite/F05537' },
          fields: [
            ['guest','Guest'],
            ['count','Guests'],
            ['slot','Time Slot'],
            ['event','Event'],
            ['status','Status'],
            ['next','Next Step'],
          ]
        },
        campaign: {
          title: 'Campaign CRM',
          brand: { name: 'Meta + CRM', logo: 'https://cdn.simpleicons.org/meta/0866FF' },
          fields: [
            ['campaign','Campaign'],
            ['source','Source'],
            ['segment','Segment'],
            ['status','Status'],
            ['last','Last Touch'],
            ['next','Next Step'],
          ]
        },
        finance: {
          title: 'Case CRM',
          brand: { name: 'Finance CRM', logo: 'https://cdn.simpleicons.org/stripe/635BFF' },
          fields: [
            ['applicant','Applicant'],
            ['profile','Profile'],
            ['income','Income'],
            ['status','Status'],
            ['docs','Documents'],
            ['next','Next Step'],
          ]
        },
        ops: {
          title: 'Ops Workflow',
          brand: { name: 'Bitrix24', logo: 'https://cdn.simpleicons.org/bitrix24/2FC6F6' },
          fields: [
            ['task','Task'],
            ['owner','Owner'],
            ['rules','Routing'],
            ['status','Status'],
            ['log','Log'],
            ['next','Next Step'],
          ]
        },
        commerce: {
          title: 'Orders',
          brand: { name: 'Shopify', logo: 'https://cdn.simpleicons.org/shopify/95BF47' },
          fields: [
            ['order','Order'],
            ['items','Items'],
            ['total','Total'],
            ['payment','Payment'],
            ['address','Delivery'],
            ['status','Status'],
          ]
        },
        appointment: {
          title: 'Appointments',
          brand: { name: 'Booking CRM', logo: 'https://cdn.simpleicons.org/googlecalendar/4285F4' },
          fields: [
            ['name','Name'],
            ['service','Service'],
            ['time','Time'],
            ['status','Status'],
            ['notes','Notes'],
            ['next','Next Step'],
          ]
        },
        booking: {
          title: 'Bookings',
          brand: { name: 'Hospitality CRM', logo: 'https://cdn.simpleicons.org/bookingdotcom/003580' },
          fields: [
            ['guest','Guest'],
            ['dates','Dates'],
            ['room','Room'],
            ['rate','Rate'],
            ['status','Status'],
            ['next','Next Step'],
          ]
        }
      };

      // Role -> CRM mode
      const ROLE_TO_MODE = {
        'Sales Agent': 'pipeline',
        'Property Concierge': 'pipeline',
        'Leasing Agent': 'rental',
        'Customer Support': 'ticket',
        'Event Host': 'rsvp',
        'Marketing Coordinator': 'campaign',
        'Mortgage Advisor': 'finance',
        'Operations Admin': 'ops',
        'Order Assistant (Shopify)': 'commerce',
        'Restaurant Orders': 'commerce',
        'Appointment Booker': 'appointment',
        'Hotel Booking': 'booking',
      };

      // Runtime state
      let runToken = 0;
      let isFlowActive = false;
      let activeMode = 'pipeline';
      let fieldEls = {}; // key -> element

      // Build CRM fields for selected mode
      function setCrmMode(modeKey){
        const m = CRM_MODES[modeKey] || CRM_MODES.pipeline;
        activeMode = modeKey;

        crmTitle.textContent = m.title;
        crmBrandName.textContent = m.brand.name;
        crmBrandLogo.src = m.brand.logo;

        // Rebuild fields
        crmFields.innerHTML = '';
        fieldEls = {};
        m.fields.forEach(([key,label])=>{
          const wrap = document.createElement('div');
          wrap.className = 'crm-field';
          wrap.dataset.key = key;
          wrap.innerHTML = '<b></b><span>—</span>';
          wrap.querySelector('b').textContent = label;
          crmFields.appendChild(wrap);
          fieldEls[key] = wrap;
        });

        // Reset subtitle/sync
        crmSubtitle.textContent = 'Waiting for lead data...';
        setSyncing(false, 'Idle');
      }

      function setSyncing(on, text){
        if(on){
          crmSync.classList.add('is-syncing');
          syncChip.classList.add('is-syncing');
          syncText.textContent = text || 'Syncing...';
        }else{
          crmSync.classList.remove('is-syncing');
          syncChip.classList.remove('is-syncing');
          syncText.textContent = text || 'Synced';
        }
      }

      function resetState(){
        messagesScroll.innerHTML = '';
        composeInput.textContent = 'Type a message...';
        roleButtons.forEach(b=>b.classList.remove('is-active'));
        designerHint.textContent = 'Choose a role to start';
        designerFootHint.textContent = 'Pick a role, then watch WhatsApp capture details and sync the right CRM model.';
        setStage('stage-designer');
        setCrmMode('pipeline');
      }

      function scrollToBottom(){
        messagesScroll.scrollTop = messagesScroll.scrollHeight;
      }

      function addBubble(from, text){
        const row = document.createElement('div');
        row.className = 'bubble-row';
        const bub = document.createElement('div');
        bub.className = 'bubble ' + (from === 'user' ? 'user' : 'ai');
        bub.textContent = text;
        row.appendChild(bub);
        messagesScroll.appendChild(row);
        scrollToBottom();
      }

      // AI glow (brief)
      function pulseAiGlow(){
        chatMessagesBox.classList.remove('ai-glow');
        // force reflow
        void chatMessagesBox.offsetWidth;
        chatMessagesBox.classList.add('ai-glow');
      }

      // Typing indicator
      let typingEl = null;
      function showTyping(on){
        if(on && !typingEl){
          const row = document.createElement('div');
          row.className = 'typing-row';
          const indicator = document.createElement('div');
          indicator.className = 'typing-indicator';
          indicator.innerHTML = '<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>';
          row.appendChild(indicator);
          messagesScroll.appendChild(row);
          typingEl = {row, indicator};
          requestAnimationFrame(()=>indicator.classList.add('is-visible'));
          scrollToBottom();
          pulseAiGlow();
        }else if(!on && typingEl){
          typingEl.indicator.classList.remove('is-visible');
          const r = typingEl.row;
          setTimeout(()=>{ try{ r.remove(); }catch(e){} }, 250);
          typingEl = null;
        }
      }

      async function typeInCompose(text, token){
        composeInput.textContent = '';
        for(let i=0;i<text.length;i++){
          if(token !== runToken) return;
          composeInput.textContent = text.slice(0, i+1);
          await sleep(26 + rand(18, 34));
        }
        await sleep(320 + rand(120, 220));
      }

      function flashField(key){
        const f = fieldEls[key];
        if(!f) return;
        f.classList.remove('is-updated');
        void f.offsetWidth;
        f.classList.add('is-updated');
        setTimeout(()=>f.classList.remove('is-updated'), 1300);
      }

      function updateCRMField(key, value){
        const f = fieldEls[key];
        if(!f) return;
        f.querySelector('span').textContent = value;
        flashField(key);
      }

      async function applyCRMUpdates(updates, note, token){
        if(token !== runToken) return;
        setSyncing(true, 'Syncing...');
        crmSubtitle.textContent = note || 'Processing...';

        const keys = Object.keys(updates || {});
        for(const k of keys){
          if(token !== runToken) return;
          await sleep(rand(160, 300));
          updateCRMField(k, updates[k]);
          haptic([6]);
        }

        await sleep(520);
        setSyncing(false, 'Synced');
      }

      // Flows (role realistic)
      const flows = {
        'Sales Agent': [
          {type:'compose', text:"Hi, I'm interested in a 2BR in Dubai Hills."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Hey! Love that area — are you buying to live in or invest?"},
          {type:'crm', note:"Lead captured", updates:{lead:'New WhatsApp Lead', stage:'New', intent:'Property Inquiry', area:'Dubai Hills'}},

          {type:'compose', text:"Investment."},
          {type:'typing', ms:1700},
          {type:'ai', text:"Perfect. What budget range feels right — under 2M, 2–3M, or 3M+?"},
          {type:'crm', note:"Intent updated", updates:{stage:'Qualifying', intent:'Investor'}},

          {type:'compose', text:"Around 2–3M."},
          {type:'typing', ms:1800},
          {type:'ai', text:"Got it. I’ll line up 3 options with payment plans + rental estimates. Any preference on view?"},
          {type:'crm', note:"Budget captured", updates:{budget:'AED 2–3M', stage:'Qualified', next:'Send 3 options'}},
        ],

        'Leasing Agent': [
          {type:'compose', text:"Hello, I'm looking for a 1BR in Business Bay."},
          {type:'typing', ms:1500},
          {type:'ai', text:"Sure. When are you planning to move in?"},
          {type:'crm', note:"Inquiry created", updates:{lead:'New Tenant', stage:'New', area:'Business Bay'}},

          {type:'compose', text:"Next month ideally."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Great. What budget should I work within — 7–9k, 9–12k, or 12k+ per month?"},
          {type:'crm', note:"Timeline captured", updates:{movein:'Next month', stage:'Qualifying', next:'Confirm budget'}},

          {type:'compose', text:"9–12k works."},
          {type:'typing', ms:1700},
          {type:'ai', text:"Perfect. Furnished or unfurnished — and do you want a metro walk?"},
          {type:'crm', note:"Budget captured", updates:{budget:'AED 9–12k/mo', stage:'Qualified'}},
        ],

        'Customer Support': [
          {type:'compose', text:"Hi, I didn't receive the brochure."},
          {type:'typing', ms:1400},
          {type:'ai', text:"I’ve got you. What’s the phone number you used so I can resend it?"},
          {type:'crm', note:"Ticket opened", updates:{ticket:'#T-1042', issue:'Brochure not received', priority:'Normal', status:'Open', assigned:'Support', next:'Verify + resend'}},

          {type:'compose', text:"+971 5X XXX XXXX"},
          {type:'typing', ms:1500},
          {type:'ai', text:"Thanks. Resending now — I’ll also attach a backup PDF here."},
          {type:'crm', note:"Resolved", updates:{status:'Resolved', next:'Confirm delivery'}},
        ],

        'Event Host': [
          {type:'compose', text:"Is there a property show this weekend?"},
          {type:'typing', ms:1400},
          {type:'ai', text:"Yes. How many guests will you be bringing?"},
          {type:'crm', note:"RSVP created", updates:{guest:'New Guest', count:'—', event:'Property Show', status:'Invited', next:'Guest count + slot'}},

          {type:'compose', text:"2 guests."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Perfect. Afternoon or evening slot?"},
          {type:'crm', note:"Guest count captured", updates:{count:'2', status:'Pending slot', next:'Confirm time slot'}},

          {type:'compose', text:"Evening."},
          {type:'typing', ms:1700},
          {type:'ai', text:"Done. I’ll send the location + parking details shortly."},
          {type:'crm', note:"Confirmed", updates:{slot:'Evening', status:'Confirmed', next:'Send location'}},
        ],

        'Marketing Coordinator': [
          {type:'compose', text:"Can you follow up yesterday’s campaign leads?"},
          {type:'typing', ms:1500},
          {type:'ai', text:"Absolutely. Do you want a soft check-in or a direct offer message?"},
          {type:'crm', note:"Workflow started", updates:{campaign:'Meta Lead Gen', source:'Instagram', segment:'Mixed', status:'Drafting', last:'Yesterday', next:'Pick tone'}},

          {type:'compose', text:"Soft check-in."},
          {type:'typing', ms:1700},
          {type:'ai', text:"Got it. I’ll send a gentle message with one qualifying question. Which project should I prioritize?"},
          {type:'crm', note:"Tone set", updates:{status:'In progress', next:'Confirm project'}},
        ],

        'Mortgage Advisor': [
          {type:'compose', text:"Can I qualify for a home loan in Dubai?"},
          {type:'typing', ms:1600},
          {type:'ai', text:"Let’s check. Are you salaried or self-employed?"},
          {type:'crm', note:"Case created", updates:{applicant:'New Applicant', profile:'—', income:'—', status:'New', docs:'Pending', next:'Capture profile'}},

          {type:'compose', text:"Salaried."},
          {type:'typing', ms:1700},
          {type:'ai', text:"Great. What’s your approximate monthly income?"},
          {type:'crm', note:"Profile captured", updates:{profile:'Salaried', status:'Qualifying', next:'Capture income'}},

          {type:'compose', text:"Around 35k."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Thanks. I’ll estimate eligibility and share the document list for pre-approval."},
          {type:'crm', note:"Income captured", updates:{income:'AED 35k/mo', docs:'List required', status:'In review', next:'Send document checklist'}},
        ],

        'Property Concierge': [
          {type:'compose', text:"We’re relocating to Dubai — can you help shortlist areas?"},
          {type:'typing', ms:1600},
          {type:'ai', text:"Of course. Are you prioritizing commute, schools, or lifestyle?"},
          {type:'crm', note:"Discovery started", updates:{lead:'Relocation Lead', stage:'Discovery', intent:'Relocation', area:'—', next:'Capture priorities'}},

          {type:'compose', text:"Schools and quiet neighborhoods."},
          {type:'typing', ms:1800},
          {type:'ai', text:"Perfect. What budget range and how many bedrooms?"},
          {type:'crm', note:"Priorities captured", updates:{stage:'Qualifying', next:'Budget + bedrooms'}},
        ],

        'Operations Admin': [
          {type:'compose', text:"Can you log today’s WhatsApp inquiries into the CRM?"},
          {type:'typing', ms:1400},
          {type:'ai', text:"On it. Who should receive Dubai Hills leads?"},
          {type:'crm', note:"Task created", updates:{task:'Log inquiries', owner:'Ops', rules:'—', status:'In progress', log:'Started', next:'Confirm routing'}},

          {type:'compose', text:"Assign to Nadia."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Done. Dubai Hills → Nadia. Auto-routing is active."},
          {type:'crm', note:"Rules saved", updates:{rules:'Dubai Hills → Nadia', status:'Saved', log:'Routing updated', next:'Auto-route active'}},
        ],

        'Order Assistant (Shopify)': [
          {type:'compose', text:"Hi, is the chocolate cookies box available?"},
          {type:'typing', ms:1400},
          {type:'ai', text:"Yes 😊 How many boxes would you like?"},
          {type:'crm', note:"Order started", updates:{order:'#S-2207', items:'Chocolate Cookies (Box)', total:'—', payment:'—', address:'—', status:'New'}},

          {type:'compose', text:"3 boxes."},
          {type:'typing', ms:1500},
          {type:'ai', text:"Got it. Delivery area please?"},
          {type:'crm', note:"Items updated", updates:{items:'Chocolate Cookies ×3', status:'Confirming delivery'}},

          {type:'compose', text:"JLT."},
          {type:'typing', ms:1600},
          {type:'ai', text:"Perfect. Total is AED 90 + AED 10 delivery = AED 100. Cash on delivery or card?"},
          {type:'crm', note:"Total calculated", updates:{total:'AED 100', address:'JLT', status:'Awaiting payment method'}},

          {type:'compose', text:"Cash on delivery."},
          {type:'typing', ms:1400},
          {type:'ai', text:"Done 👍 Please share building + apartment number."},
          {type:'crm', note:"Payment method saved", updates:{payment:'COD', status:'Confirmed'}},
        ],

        'Restaurant Orders': [
          {type:'compose', text:"Hi, can I order 2 chicken shawarma and 1 fries?"},
          {type:'typing', ms:1350},
          {type:'ai', text:"Sure. Delivery or pickup?"},
          {type:'crm', note:"Order started", updates:{order:'#F-5112', items:'Chicken Shawarma ×2, Fries ×1', total:'—', payment:'—', address:'—', status:'New'}},

          {type:'compose', text:"Delivery."},
          {type:'typing', ms:1450},
          {type:'ai', text:"Got it. Share your area + building, please."},
          {type:'crm', note:"Delivery captured", updates:{status:'Capturing address'}},

          {type:'compose', text:"Al Barsha, Al Noor Building."},
          {type:'typing', ms:1500},
          {type:'ai', text:"Perfect. Total AED 41 + delivery AED 6 = AED 47. Cash or card?"},
          {type:'crm', note:"Total calculated", updates:{address:'Al Barsha — Al Noor Building', total:'AED 47', status:'Awaiting payment method'}},
        ],

        'Appointment Booker': [
          {type:'compose', text:"Hi, I need a haircut appointment tomorrow."},
          {type:'typing', ms:1400},
          {type:'ai', text:"Sure. What time works best — morning, afternoon, or evening?"},
          {type:'crm', note:"Appointment started", updates:{name:'New Client', service:'Haircut', time:'—', status:'Pending time', notes:'Requested tomorrow', next:'Confirm time'}},

          {type:'compose', text:"Evening, around 7."},
          {type:'typing', ms:1400},
          {type:'ai', text:"Perfect. I’ll book 7:00 PM and send a confirmation."},
          {type:'crm', note:"Booked", updates:{time:'Tomorrow 7:00 PM', status:'Confirmed', next:'Send confirmation'}},
        ],

        'Hotel Booking': [
          {type:'compose', text:"Hi, do you have a room available for 2 nights next week?"},
          {type:'typing', ms:1500},
          {type:'ai', text:"Yes. What dates and how many guests?"},
          {type:'crm', note:"Booking started", updates:{guest:'New Guest', dates:'—', room:'—', rate:'—', status:'New', next:'Capture dates + guests'}},

          {type:'compose', text:"Mon–Wed, 2 guests."},
          {type:'typing', ms:1500},
          {type:'ai', text:"Great. Do you prefer standard or sea-view?"},
          {type:'crm', note:"Dates captured", updates:{dates:'Mon–Wed (2 nights)', status:'Qualifying', next:'Select room type'}},
        ],
      };

      // Reveal rhythm
      async function transitionToChat(role){
        setStage('stage-chat');
        await sleep(240);
        // light settle
        await sleep(260);
        chatRole.textContent = role;
      }

      async function transitionToCrm(){
        // softer, delayed switch to feel inevitable
        await sleep(260);
        setStage('stage-crm');
      }

      async function runFlow(role){
        const token = ++runToken;
        isFlowActive = true;

        // Set active role button
        roleButtons.forEach(b=>b.classList.toggle('is-active', b.dataset.role === role));

        // Update hints + mode
        designerHint.textContent = role;
        designerFootHint.textContent = 'Simulation running — card focus will follow the conversation.';
        const mode = ROLE_TO_MODE[role] || 'pipeline';
        setCrmMode(mode);

        // Reset conversation & CRM values
        messagesScroll.innerHTML = '';
        composeInput.textContent = 'Type a message...';
        setSyncing(false, 'Idle');
        crmSubtitle.textContent = 'Waiting for lead data...';

        // Move focus to chat
        await transitionToChat(role);

        const steps = flows[role] || [];
        let crmStarted = false;

        for(const step of steps){
          if(token !== runToken) return;

          if(step.type === 'compose'){
            await typeInCompose(step.text, token);
            if(token !== runToken) return;
            addBubble('user', step.text);
            composeInput.textContent = 'Type a message...';
            haptic([6]);
            await sleep(720 + rand(200, 420));
          }

          if(step.type === 'typing'){
            showTyping(true);
            await sleep(step.ms || 1500);
            showTyping(false);
            await sleep(220);
          }

          if(step.type === 'ai'){
            pulseAiGlow();
            addBubble('ai', step.text);
            await sleep(820 + rand(220, 420));
          }

          if(step.type === 'crm'){
            if(!crmStarted){
              crmStarted = true;
              await transitionToCrm();
              await sleep(420);
            }
            await applyCRMUpdates(step.updates, step.note, token);
            await sleep(640);
          }
        }

        designerFootHint.textContent = 'Ready — switch roles anytime.';
        isFlowActive = false;
      }

      // UI events
      roleButtons.forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          const role = btn.dataset.role;
          haptic([8]);
          runFlow(role);
        });
      });

      resetBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        runToken++;
        isFlowActive = false;
        resetState();
        haptic([6]);
      });

      // Init
      resetState();
    })();
  </script>
</body>
</html>


/* ===== FILE: anomationlogowith3cardsbehind.html ===== */
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>espaciso — AI for WhatsApp & Instagram</title>
  <meta name="description" content="espaciso: AI automation for WhatsApp & Instagram. Integrate, deploy, and scale conversations." />

  <style>
    :root {
      --page-bg: #E6E9ED;
      --text: #0F0F10;
      --muted: rgba(90,90,90,.9);
      --accent: #B6FF3B;
      --accent-dark: #9de62e;
      --font: system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Display","Inter",sans-serif;

      --glass-bg: rgba(255,255,255,.32);
      --glass-bg-strong: rgba(255,255,255,.5);
      --glass-border: rgba(255,255,255,.6);

      --shadow-xl: 0 40px 120px rgba(0,0,0,.12), 0 16px 48px rgba(0,0,0,.08);
      --shadow-lg: 0 24px 64px rgba(0,0,0,.10);
      --shadow-md: 0 16px 40px rgba(0,0,0,.08);
      --shadow-sm: 0 8px 24px rgba(0,0,0,.06);

      --ease: cubic-bezier(.16, 1, .3, 1);
      --ease-out: cubic-bezier(.0, 0, .2, 1);

      --logo-size: 96px;
      --logo-final-scale: 2.8;

      --hero-right-offset: 20px; 
      --hero-right-raise: -40px; 

      --card-w: calc(var(--logo-size) * 0.9);
      --card-h: calc(var(--logo-size) * .55);
      --card-radius: 18px;
      --card-overlap: 32px;

      --dock-pad: 32px;
      --dock-size: 128px;       
      --dock-shadow: 0 18px 54px rgba(0,0,0,.22), 0 6px 18px rgba(0,0,0,.10);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font);
      background: var(--page-bg);
      color: var(--text);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      position: relative;
    }

    /* ========================
       THE ONE LOGO
       ======================== */
    .the-logo {
      z-index: 2000;
      width: var(--logo-size);
      height: var(--logo-size);
      transform-origin: center center;
      will-change: transform, left, top;
      transition: opacity 0.8s var(--ease);
    }

    .the-logo[data-phase="loading"] {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events: none;
    }

    .the-logo[data-phase="hero"] {
      position: absolute; 
      pointer-events: auto;
      cursor: pointer;
      opacity: 1;
    }

    .the-logo[data-phase="dock"] {
      position: fixed; 
      pointer-events: auto;
      cursor: pointer;
      width: var(--dock-size);
      height: var(--dock-size);
      border-radius: 32px;
      opacity: 1;
    }

    .the-logo .float-layer {
      position: relative;
      width: 100%;
      height: 100%;
      display: block;
      will-change: transform;
      z-index: 5;
    }

    /* ========================
       LOGO FILL ANIMATION (Water effect)
       ======================== */
    .logo-base,
    .logo-fill {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
    }

    /* Dark silhouette - the "empty" container */
    .logo-base {
      filter: brightness(0) opacity(0.12);
      z-index: 1;
    }

    /* Colored version - fills up like water */
    .logo-fill {
      z-index: 2;
      filter: drop-shadow(0 28px 56px rgba(0,0,0,.18)) drop-shadow(0 10px 22px rgba(0,0,0,.10));
      clip-path: inset(100% 0 0 0); /* Start hidden (clipped from top) */
    }

    /* Trigger fill animation during loading */
    .the-logo[data-phase="loading"] .logo-fill {
      animation: waterFill 1.4s var(--ease-out) 0.6s forwards;
    }

    @keyframes waterFill {
      0% { 
        clip-path: inset(100% 0 0 0); /* Fully hidden */
      }
      100% { 
        clip-path: inset(0 0 0 0); /* Fully revealed */
      }
    }

    /* After loading, show full logo normally */
    .the-logo[data-phase="hero"] .logo-fill,
    .the-logo[data-phase="dock"] .logo-fill {
      clip-path: inset(0 0 0 0);
      animation: none;
    }

    .the-logo[data-phase="hero"] .logo-base,
    .the-logo[data-phase="dock"] .logo-base {
      opacity: 0; /* Hide silhouette after loading */
    }

    .the-logo[data-phase="dock"] .logo-fill {
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.15));
    }

    /* Dock glow ring */
    .the-logo .dock-ring {
      position: absolute;
      inset: -8px;
      border-radius: 40px;
      background: radial-gradient(closest-side, rgba(182,255,59,.4), rgba(182,255,59,0));
      opacity: 0;
      transform: scale(.8);
      transition: opacity .4s var(--ease), transform .4s var(--ease);
      pointer-events: none;
      z-index: 0;
    }
    .the-logo[data-phase="dock"] .dock-ring { opacity: 1; transform: scale(1); }

    /* ========================
       3 CONNECTED CARDS
       ======================== */
    .logo-cards {
      position: absolute;
      inset: 0;
      z-index: 1;
      pointer-events: none;
    }

    .logo-card {
      position: absolute;
      width: var(--card-w);
      height: var(--card-h);
      border-radius: var(--card-radius);
      background: rgba(255,255,255,.22);
      border: 1px solid rgba(255,255,255,.50);
      backdrop-filter: blur(18px);
      box-shadow: 0 28px 76px rgba(0,0,0,.10), inset 0 1px 0 rgba(255,255,255,.35);
      transform-origin: center;
      transition: opacity .5s var(--ease), transform .6s var(--ease);
      will-change: transform, opacity;
      opacity: 0;
      transform: scale(0.8);
    }

    .logo-card.card-ul {
      right: calc(100% - var(--card-overlap) - 8px);
      bottom: calc(50% - 38px);
    }
    .logo-card.card-ll {
      right: calc(100% - var(--card-overlap) - 8px);
      top: calc(50% - 2px);
    }
    .logo-card.card-r {
      left: calc(100% - var(--card-overlap) - 4px);
      top: 50%;
    }

    .the-logo[data-phase="hero"] .logo-card { 
      opacity: .65; 
      transform: scale(1);
    }
    
    .the-logo[data-phase="hero"] .logo-card.card-ul { transform: translateY(-100%) scale(1); }
    .the-logo[data-phase="hero"] .logo-card.card-ll { transform: translateY(0) scale(1); }
    .the-logo[data-phase="hero"] .logo-card.card-r  { transform: translateY(-50%) scale(1); }

    .the-logo[data-phase="loading"] .logo-card,
    .the-logo[data-phase="dock"] .logo-card {
      opacity: 0;
      transform: translate(0, 0) scale(0) !important;
    }

    @keyframes cardFloatUL { 0%, 100% { transform: translateY(-100%) translate(0, 0); } 50% { transform: translateY(-100%) translate(6px, -6px); } }
    @keyframes cardFloatLL { 0%, 100% { transform: translateY(0) translate(0, 0); } 50% { transform: translateY(0) translate(4px, 8px); } }
    @keyframes cardFloatR { 0%, 100% { transform: translateY(-50%) translate(0, 0); } 50% { transform: translateY(-50%) translate(8px, 2px); } }
    
    .the-logo[data-phase="hero"] .logo-card.card-ul { animation: cardFloatUL 6s ease-in-out infinite; }
    .the-logo[data-phase="hero"] .logo-card.card-ll { animation: cardFloatLL 7s ease-in-out infinite; }
    .the-logo[data-phase="hero"] .logo-card.card-r  { animation: cardFloatR 8s ease-in-out infinite; }

    /* ========================
       LOGO FLOAT ANIMATIONS
       ======================== */
    @keyframes logoHeroFloat { 0%, 100% { transform: translateY(0) rotate(-0.5deg); } 50% { transform: translateY(-10px) rotate(0.5deg); } }

    .the-logo[data-phase="loading"] .float-layer,
    .the-logo[data-phase="hero"] .float-layer { animation: logoHeroFloat 5s ease-in-out infinite; }
    .the-logo[data-phase="dock"] .float-layer { animation: none; transform: none !important; }

    /* ========================
       INTRO OVERLAY
       ======================== */
    .intro-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: var(--page-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 18px;
      transition: opacity .6s var(--ease), visibility .6s;
    }
    .intro-overlay.is-hidden { opacity: 0; visibility: hidden; pointer-events: none; }

    .intro-text {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.08em;
      color: rgba(15,15,16,.7);
      opacity: 0;
      transform: translateY(10px);
      animation: introTextIn .6s var(--ease) 1.6s forwards; /* Delayed to appear after fill */
    }
    
    @keyframes introTextIn { to { opacity: 1; transform: translateY(0); } }

    /* ========================
       PAGE
       ======================== */
    .page {
      min-height: 100vh;
      position: relative;
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(800px 500px at 85% 15%, rgba(255,255,255,.5), transparent 55%),
        linear-gradient(165deg, #EEF1F5 0%, #E4E7EB 45%, #D9DEE4 100%);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .8s var(--ease), transform .8s var(--ease);
    }
    .page.is-visible { opacity: 1; transform: translateY(0); }

    /* ========================
       SECTIONS
       ======================== */
    .section {
      width: min(1200px, calc(100% - 40px));
      margin: 0 auto;
      padding: 100px 0;
    }
    .section-header { text-align: center; margin-bottom: 60px; }
    .section-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 999px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      font-size: 13px;
      font-weight: 600;
      color: rgba(15,15,16,.7);
      margin-bottom: 20px;
    }
    .section-title {
      font-size: clamp(32px, 4.5vw, 52px);
      font-weight: 760;
      letter-spacing: -0.03em;
      line-height: 1.1;
      margin-bottom: 16px;
    }
    .section-sub {
      font-size: 17px;
      color: var(--muted);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* ========================
       HERO
       ======================== */
    .hero {
      padding: 120px 0 100px;
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 60px;
      align-items: center;
      position: relative;
    }
    .hero-content {
      position: relative;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity .7s var(--ease), transform .7s var(--ease);
      z-index: 10;
    }
    .hero-content.is-visible { opacity: 1; transform: translateY(0); }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(14px);
      font-size: 13px;
      font-weight: 600;
      color: rgba(15,15,16,.7);
      margin-bottom: 18px;
    }
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(182,255,59,.2), 0 0 12px rgba(182,255,59,.4);
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%,100% { box-shadow: 0 0 0 4px rgba(182,255,59,.2), 0 0 12px rgba(182,255,59,.4); }
      50% { box-shadow: 0 0 0 8px rgba(182,255,59,.1), 0 0 20px rgba(182,255,59,.3); }
    }

    .hero-title {
      font-size: clamp(42px, 5.5vw, 72px);
      line-height: 1.0;
      letter-spacing: -0.04em;
      font-weight: 780;
      margin-bottom: 18px;
    }
    .hero-title .highlight {
      background: linear-gradient(135deg, var(--accent) 0%, rgba(182,255,59,.7) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero-sub {
      font-size: 17px;
      line-height: 1.6;
      color: var(--muted);
      max-width: 480px;
      margin-bottom: 30px;
    }

    .hero-ctas { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; }
    .btn-primary {
      padding: 16px 28px;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 700;
      color: rgba(10,10,10,.9);
      background: linear-gradient(135deg, var(--accent) 0%, rgba(182,255,59,.85) 100%);
      border: 1px solid rgba(182,255,59,.5);
      box-shadow: 0 20px 50px rgba(182,255,59,.25), 0 8px 24px rgba(0,0,0,.08);
      cursor: pointer;
      transition: all .3s var(--ease);
    }
    .btn-primary:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 28px 60px rgba(182,255,59,.3); }

    .btn-secondary {
      padding: 16px 24px;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 600;
      color: rgba(15,15,16,.75);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(14px);
      cursor: pointer;
      transition: all .3s var(--ease);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-secondary:hover { transform: translateY(-2px); background: rgba(255,255,255,.45); }
    .btn-secondary svg { width: 18px; height: 18px; fill: currentColor; }

    .hero-stats {
      display: flex;
      align-items: center;
      gap: 32px;
      margin-top: 36px;
      padding-top: 28px;
      border-top: 1px solid rgba(15,15,16,.06);
    }
    .stat { display: flex; flex-direction: column; gap: 4px; }
    .stat-value { font-size: 26px; font-weight: 750; letter-spacing: -0.03em; }
    .stat-label { font-size: 13px; color: var(--muted); }

    .hero-visual {
      position: relative;
      min-height: 480px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .anchor { 
      position: absolute; 
      width: 1px; 
      height: 1px; 
      pointer-events: none; 
      opacity: 0; 
    }
    .anchor.right {
      left: 50%;
      top: 50%;
      transform: translate(calc(-50% + var(--hero-right-offset)), calc(-50% + var(--hero-right-raise)));
    }

    .dock-sentinel {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 20px; 
      height: 20px;
      opacity: 0;
      pointer-events: none;
    }

    /* ========================
       FEATURES
       ======================== */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }
    .feature-card {
      padding: 32px;
      border-radius: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow-md);
      transition: all .3s var(--ease);
    }
    .feature-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); background: var(--glass-bg-strong); }

    .feature-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent) 0%, rgba(182,255,59,.6) 100%);
      display: grid;
      place-items: center;
      margin-bottom: 20px;
      box-shadow: 0 8px 24px rgba(182,255,59,.2);
    }
    .feature-icon svg { width: 28px; height: 28px; stroke: rgba(10,10,10,.8); fill: none; stroke-width: 2; }
    .feature-title { font-size: 20px; font-weight: 700; margin-bottom: 10px; }
    .feature-desc { font-size: 15px; color: var(--muted); line-height: 1.6; }
    
    /* ========================
       PLAYGROUND
       ======================== */
    .playground-container {
      width: min(1000px, 100%);
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      padding: 40px;
      border-radius: 32px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-lg);
    }
    
    .playground-input-group {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .playground-input-group label {
      font-size: 14px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .playground-textarea {
      width: 100%;
      height: 140px;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid rgba(15,15,16,.1);
      background: rgba(255,255,255,.6);
      font-family: var(--font);
      font-size: 16px;
      color: var(--text);
      resize: none;
      transition: all .2s;
    }
    .playground-textarea:focus {
      outline: none;
      border-color: var(--accent-dark);
      background: white;
      box-shadow: 0 0 0 4px rgba(182,255,59,.2);
    }

    .playground-controls {
      display: flex;
      gap: 12px;
    }

    .playground-select {
      flex: 1;
      padding: 0 16px;
      border-radius: 12px;
      border: 1px solid rgba(15,15,16,.1);
      background: rgba(255,255,255,.6);
      font-family: var(--font);
      font-size: 14px;
      color: var(--text);
      cursor: pointer;
    }

    .playground-output {
      display: flex;
      flex-direction: column;
      gap: 16px;
      border-left: 1px solid rgba(15,15,16,.1);
      padding-left: 32px;
    }
    
    .output-content {
      flex: 1;
      padding: 24px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(255,255,255,.8) 0%, rgba(255,255,255,.5) 100%);
      border: 1px solid rgba(255,255,255,.8);
      font-size: 17px;
      line-height: 1.6;
      color: var(--text);
      position: relative;
    }
    
    .output-content.loading::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,.6);
      backdrop-filter: blur(4px);
      border-radius: 20px;
    }
    
    .loading-spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      border: 3px solid var(--accent);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin .8s linear infinite;
      z-index: 10;
      display: none;
    }
    .output-content.loading .loading-spinner { display: block; }
    
    @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

    @media (max-width: 800px) {
      .playground-container { grid-template-columns: 1fr; padding: 24px; }
      .playground-output { border-left: none; padding-left: 0; border-top: 1px solid rgba(15,15,16,.1); padding-top: 24px; }
    }


    /* ========================
       PRICING
       ======================== */
    .pricing-section { background: linear-gradient(180deg, transparent 0%, rgba(255,255,255,.3) 50%, transparent 100%); }

    .pricing-toggle { display: flex; justify-content: center; margin-bottom: 48px; }
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 6px;
      border-radius: 16px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
    }
    .toggle-option {
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      color: var(--muted);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all .25s var(--ease);
    }
    .toggle-option.active { background: white; color: var(--text); box-shadow: var(--shadow-sm); }
    .toggle-save {
      padding: 4px 10px;
      border-radius: 8px;
      background: var(--accent);
      font-size: 12px;
      font-weight: 700;
      color: rgba(10,10,10,.8);
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      align-items: start;
    }
    .price-card {
      padding: 36px;
      border-radius: 28px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow-md);
      transition: all .3s var(--ease);
      position: relative;
    }
    .price-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .price-card.featured {
      background: linear-gradient(135deg, rgba(255,255,255,.6) 0%, rgba(255,255,255,.4) 100%);
      border: 2px solid var(--accent);
      box-shadow: var(--shadow-lg), 0 0 40px rgba(182,255,59,.15);
      transform: scale(1.02);
    }
    .price-card.featured:hover { transform: scale(1.02) translateY(-4px); }

    .price-badge {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 16px;
      border-radius: 20px;
      background: var(--accent);
      font-size: 12px;
      font-weight: 700;
      color: rgba(10,10,10,.9);
      box-shadow: 0 4px 12px rgba(182,255,59,.3);
    }
    .price-name { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .price-desc { font-size: 14px; color: var(--muted); margin-bottom: 24px; }

    .price-amount { display: flex; align-items: baseline; gap: 4px; margin-bottom: 8px; }
    .price-currency { font-size: 24px; font-weight: 700; }
    .price-value { font-size: 56px; font-weight: 800; letter-spacing: -0.04em; line-height: 1; }
    .price-period { font-size: 16px; color: var(--muted); font-weight: 500; }
    .price-per-msg { font-size: 13px; color: var(--muted); margin-bottom: 28px; padding-bottom: 28px; border-bottom: 1px solid rgba(15,15,16,.08); }

    .price-features { list-style: none; margin-bottom: 28px; }
    .price-features li { display: flex; align-items: flex-start; gap: 12px; font-size: 14px; color: rgba(15,15,16,.8); padding: 10px 0; }
    .price-features li svg { width: 20px; height: 20px; stroke: var(--accent-dark); stroke-width: 2.5; fill: none; flex-shrink: 0; margin-top: 1px; }

    .price-cta { width: 100%; padding: 14px 24px; border-radius: 14px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all .25s var(--ease); }
    .price-cta.primary { background: var(--accent); color: rgba(10,10,10,.9); border: none; box-shadow: 0 8px 24px rgba(182,255,59,.25); }
    .price-cta.primary:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(182,255,59,.35); }
    .price-cta.secondary { background: var(--glass-bg); color: var(--text); border: 1px solid var(--glass-border); }
    .price-cta.secondary:hover { background: rgba(255,255,255,.5); }

    .comparison-table { width: 100%; border-collapse: collapse; margin-top: 48px; }
    .comparison-table th, .comparison-table td { padding: 16px 20px; text-align: left; border-bottom: 1px solid rgba(15,15,16,.06); }
    .comparison-table th { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); background: rgba(255,255,255,.3); }
    .comparison-table th:first-child { border-radius: 12px 0 0 0; }
    .comparison-table th:last-child { border-radius: 0 12px 0 0; }
    .comparison-table td { font-size: 15px; }
    .comparison-table td:not(:first-child), .comparison-table th:not(:first-child) { text-align: center; }
    .comparison-table tbody tr:hover { background: rgba(255,255,255,.3); }
    .comparison-table .check { width: 24px; height: 24px; stroke: var(--accent-dark); stroke-width: 2.5; fill: none; }
    .comparison-table .cross { width: 24px; height: 24px; stroke: rgba(15,15,16,.25); stroke-width: 2; fill: none; }

    /* ========================
       FOOTER
       ======================== */
    .footer { padding: 60px 0 40px; border-top: 1px solid rgba(15,15,16,.06); }
    .footer-inner { width: min(1200px, calc(100% - 40px)); margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .footer-brand { display: flex; align-items: center; gap: 10px; }
    .footer-brand img { width: 32px; height: 32px; }
    .footer-brand span { font-size: 16px; font-weight: 700; }
    .footer-links { display: flex; gap: 32px; }
    .footer-links a { font-size: 14px; color: var(--muted); text-decoration: none; transition: color .2s; }
    .footer-links a:hover { color: var(--text); }
    .footer-copy { font-size: 13px; color: var(--muted); }

    /* ========================
       RESPONSIVE
       ======================== */
    @media (max-width: 1100px) {
      :root { --hero-right-offset: 0px; --hero-right-raise: -18px; }
    }
    @media (max-width: 1000px) {
      :root { --hero-right-offset: 0px; --hero-right-raise: 0px; }
      .hero { grid-template-columns: 1fr; gap: 46px; padding: 100px 0 60px; }
      .hero-content { text-align: center; }
      .hero-ctas { justify-content: center; }
      .hero-stats { justify-content: center; }
      .hero-visual { min-height: 280px; }
      .features-grid { grid-template-columns: repeat(2, 1fr); }
      .pricing-grid { grid-template-columns: 1fr; max-width: 420px; margin: 0 auto; }
      .price-card.featured { transform: none; }
      .price-card.featured:hover { transform: translateY(-4px); }
      .footer-inner { flex-direction: column; gap: 24px; text-align: center; }
    }
    @media (max-width: 600px) {
      :root {
        --logo-size: 80px;
        --logo-final-scale: 2.4;
        --card-w: calc(var(--logo-size) * 0.85);
        --card-h: calc(var(--logo-size) * .5);
        --card-overlap: 26px;
        --dock-size: 72px;
        --dock-pad: 24px;
      }
      .section { padding: 60px 0; }
      .section-title { font-size: 28px; }
      .hero-title { font-size: 34px; }
      .features-grid { grid-template-columns: 1fr; }
      .comparison-table { font-size: 13px; }
      .comparison-table th, .comparison-table td { padding: 12px 10px; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
      .intro-overlay { display: none; }
      .page { opacity: 1; transform: none; }
      .the-logo { display: none; }
      .hero-content { opacity: 1; transform: none; }
    }
  </style>
</head>

<body>
  <!-- ONE LOGO with attached cards -->
  <div class="the-logo" id="theLogo" data-phase="loading" aria-label="espaciso logo">
    <span class="dock-ring" aria-hidden="true"></span>

    <div class="logo-cards" aria-hidden="true">
      <span class="logo-card card-ul"></span>
      <span class="logo-card card-ll"></span>
      <span class="logo-card card-r"></span>
    </div>

    <span class="float-layer">
      <!-- Dark silhouette (empty container) -->
      <img class="logo-base" src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="" aria-hidden="true" />
      <!-- Colored fill (animates up like water) -->
      <img class="logo-fill" src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espaciso" />
    </span>
  </div>

  <!-- Intro Overlay (simplified - no loading bar) -->
  <div class="intro-overlay" id="introOverlay">
    <div style="height:120px"></div>
    <div class="intro-text">espaciso</div>
  </div>

  <!-- Page -->
  <main class="page" id="page">
    <!-- HERO -->
    <section class="section hero" id="heroSection">
      <div class="hero-content" id="heroContent">
        <div class="hero-badge"><span class="badge-dot"></span>AI for WhatsApp & Instagram</div>
        <h1 class="hero-title">
          Automate conversations,<br/>
          <span class="highlight">not relationships.</span>
        </h1>
        <p class="hero-sub">
          Deploy AI agents that qualify leads, answer questions, and hand off to your team — all while syncing to your CRM in real-time.
        </p>
        <div class="hero-ctas">
          <button class="btn-primary">Start Free Trial</button>
          <button class="btn-secondary">
            Watch Demo
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </button>
        </div>
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-value" id="statLeads">50K+</span>
            <span class="stat-label">Leads qualified</span>
          </div>
          <div class="stat">
            <span class="stat-value">3 min</span>
            <span class="stat-label">Avg. response</span>
          </div>
          <div class="stat">
            <span class="stat-value">98%</span>
            <span class="stat-label">Accuracy</span>
          </div>
        </div>
      </div>

      <div class="hero-visual" id="heroVisual">
        <div class="anchor right" id="anchorRight"></div>
        <div class="dock-sentinel" id="dockSentinel"></div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="section" id="features">
      <div class="section-header">
        <div class="section-badge">Features</div>
        <h2 class="section-title">Everything you need to scale</h2>
        <p class="section-sub">Powerful AI automation tools built for modern teams who want to grow without burning out.</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
          <h3 class="feature-title">AI Conversations</h3>
          <p class="feature-desc">Natural language AI that understands context and responds intelligently to customer queries 24/7.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
          <h3 class="feature-title">Lead Qualification</h3>
          <p class="feature-desc">Automatically score and qualify leads based on conversation data and custom criteria.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
          <h3 class="feature-title">Smart Handoffs</h3>
          <p class="feature-desc">Seamlessly transfer complex conversations to your human agents with full context.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg></div>
          <h3 class="feature-title">CRM Integration</h3>
          <p class="feature-desc">Sync every conversation to your CRM automatically. Works with HubSpot, Salesforce, and more.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><path d="M18 20V10M12 20V4M6 20v-6"/></svg></div>
          <h3 class="feature-title">Analytics Dashboard</h3>
          <p class="feature-desc">Real-time insights into conversation quality, response times, and conversion rates.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1 4-10z"/></svg></div>
          <h3 class="feature-title">Multi-Language</h3>
          <p class="feature-desc">AI that speaks your customers' language. Support for 50+ languages out of the box.</p>
        </div>
      </div>
    </section>
    
    <!-- AI PLAYGROUND -->
    <section class="section" id="playground">
      <div class="section-header">
        <div class="section-badge">Live Demo</div>
        <h2 class="section-title">See the AI in action</h2>
        <p class="section-sub">Type a customer message below and see how espaciso responds in real-time.</p>
      </div>
      
      <div class="playground-container">
        <div class="playground-input-group">
          <label>Customer Message</label>
          <textarea id="playgroundInput" class="playground-textarea" placeholder="e.g. Do you offer free shipping to Canada?"></textarea>
          <div class="playground-controls">
            <select id="playgroundContext" class="playground-select">
              <option value="clothing brand">Clothing Brand</option>
              <option value="saas company">SaaS Company</option>
              <option value="restaurant">Restaurant</option>
              <option value="real estate">Real Estate</option>
            </select>
            <button id="playgroundBtn" class="btn-primary" style="padding: 10px 24px; font-size: 15px;">
              Generate Response ✨
            </button>
          </div>
        </div>
        
        <div class="playground-output">
          <div class="playground-input-group">
            <label>AI Agent Response</label>
            <div id="playgroundOutput" class="output-content">
              <div class="loading-spinner"></div>
              <span id="outputPlaceholder" style="color:var(--muted)">AI response will appear here...</span>
              <span id="outputText"></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PRICING -->
    <section class="section pricing-section" id="pricing">
      <div class="section-header">
        <div class="section-badge">Pricing</div>
        <h2 class="section-title">Simple, transparent pricing</h2>
        <p class="section-sub">Start free, scale as you grow. No hidden fees, no surprises.</p>
      </div>

      <div class="pricing-toggle">
        <div class="toggle-container">
          <button class="toggle-option active" data-period="monthly">Monthly</button>
          <button class="toggle-option" data-period="annual">Annual</button>
          <span class="toggle-save">Save 20%</span>
        </div>
      </div>

      <div class="pricing-grid">
        <div class="price-card">
          <h3 class="price-name">Starter</h3>
          <p class="price-desc">Perfect for small teams getting started</p>
          <div class="price-amount">
            <span class="price-currency">$</span>
            <span class="price-value" data-monthly="49" data-annual="39">49</span>
            <span class="price-period">/mo</span>
          </div>
          <p class="price-per-msg">~$0.05 per conversation</p>
          <ul class="price-features">
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> 1,000 conversations/mo</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> 1 WhatsApp number</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Basic AI responses</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Email support</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Analytics dashboard</li>
          </ul>
          <button class="price-cta secondary">Start Free Trial</button>
        </div>

        <div class="price-card featured">
          <span class="price-badge">Most Popular</span>
          <h3 class="price-name">Pro</h3>
          <p class="price-desc">For growing teams that need more power</p>
          <div class="price-amount">
            <span class="price-currency">$</span>
            <span class="price-value" data-monthly="149" data-annual="119">149</span>
            <span class="price-period">/mo</span>
          </div>
          <p class="price-per-msg">~$0.03 per conversation</p>
          <ul class="price-features">
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> 5,000 conversations/mo</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> 3 WhatsApp numbers</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Advanced AI + training</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> CRM integration</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Priority support</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Custom workflows</li>
          </ul>
          <button class="price-cta primary">Start Free Trial</button>
        </div>

        <div class="price-card">
          <h3 class="price-name">Enterprise</h3>
          <p class="price-desc">For large teams with custom needs</p>
          <div class="price-amount">
            <span class="price-currency">$</span>
            <span class="price-value" data-monthly="499" data-annual="399">499</span>
            <span class="price-period">/mo</span>
          </div>
          <p class="price-per-msg">~$0.02 per conversation</p>
          <ul class="price-features">
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> 25,000 conversations/mo</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Unlimited numbers</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Custom AI training</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> API access</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Dedicated success manager</li>
            <li><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> SLA guarantee</li>
          </ul>
          <button class="price-cta secondary">Contact Sales</button>
        </div>
      </div>

      <table class="comparison-table">
        <thead>
          <tr><th>Feature</th><th>Starter</th><th>Pro</th><th>Enterprise</th></tr>
        </thead>
        <tbody>
          <tr><td>Monthly conversations</td><td>1,000</td><td>5,000</td><td>25,000</td></tr>
          <tr><td>WhatsApp numbers</td><td>1</td><td>3</td><td>Unlimited</td></tr>
          <tr><td>Instagram DM</td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td></tr>
          <tr><td>AI training on your data</td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td></tr>
          <tr><td>CRM integrations</td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td></tr>
          <tr><td>API access</td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td></tr>
          <tr><td>Custom workflows</td><td><svg class="cross" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td><td><svg class="check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></td></tr>
          <tr><td>Support</td><td>Email</td><td>Priority</td><td>Dedicated</td></tr>
        </tbody>
      </table>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-brand">
          <img src="https://storage.googleapis.com/espacios-data-bucket-2025/Gemini_Generated_Image_ehi1caehi1caehi1__1_-removebg-preview.png" alt="espaciso" />
          <span>espaciso</span>
        </div>
        <div class="footer-links">
          <a href="#features">Features</a>
          <a href="#pricing">Pricing</a>
          <a href="#">Docs</a>
          <a href="#">Blog</a>
          <a href="#">Contact</a>
        </div>
        <div class="footer-copy">© 2025 espaciso. All rights reserved.</div>
      </div>
    </footer>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const logo = document.getElementById('theLogo');
      const intro = document.getElementById('introOverlay');
      const page = document.getElementById('page');
      const heroContent = document.getElementById('heroContent');
      const aRight = document.getElementById('anchorRight');
      const dockSentinel = document.getElementById('dockSentinel');

      const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      
      if (reducedMotion) {
        if(intro) intro.style.display = 'none';
        if(page) page.classList.add('is-visible');
        if(logo) {
          logo.dataset.phase = 'hero';
          initLogoPosition();
        }
        if(heroContent) heroContent.classList.add('is-visible');
        initPricingToggle();
        initPlayground();
        return;
      }

      // Timing adjusted for water fill effect
      const OVERLAY_HIDE = 2400;   // After fill completes
      const MOVE_TO_HERO = 2600; 
      const TEXT_REVEAL = 3000;

      // 1. Reveal page bg after fill animation
      setTimeout(() => {
        if(intro) intro.classList.add('is-hidden');
        if(page) page.classList.add('is-visible');
      }, OVERLAY_HIDE);

      // 2. Animate Logo from Center to Hero
      setTimeout(() => {
        moveLogoToHeroInitial();
      }, MOVE_TO_HERO);

      // 3. Reveal Text
      setTimeout(() => {
        if(heroContent) heroContent.classList.add('is-visible');
      }, TEXT_REVEAL);

      function getAbsoluteAnchorPos() {
        if (!logo || !aRight) return { left: 0, top: 0 };
        const ar = aRight.getBoundingClientRect();
        const baseSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-size')) || 96;
        
        return {
          left: ar.left + window.scrollX - (baseSize / 2),
          top: ar.top + window.scrollY - (baseSize / 2)
        };
      }

      function moveLogoToHeroInitial() {
        if (!logo) return;
        
        const rect = logo.getBoundingClientRect();
        const absPos = getAbsoluteAnchorPos();
        const finalScale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-final-scale')) || 2.8;

        const targetX = absPos.left - window.scrollX;
        const targetY = absPos.top - window.scrollY;

        const anim = logo.animate([
          { left: rect.left + 'px', top: rect.top + 'px', transform: 'translate(-50%, -50%) scale(1)' },
          { left: targetX + 'px', top: targetY + 'px', transform: `translate(0, 0) scale(${finalScale})` }
        ], {
          duration: 1000,
          easing: 'cubic-bezier(.16, 1, .3, 1)',
          fill: 'forwards'
        });

        anim.onfinish = () => {
          anim.cancel(); // CRITICAL: Release fill:forwards hold
          
          logo.dataset.phase = 'hero';
          logo.style.position = 'absolute';
          logo.style.left = absPos.left + 'px';
          logo.style.top = absPos.top + 'px';
          logo.style.transform = `scale(${finalScale})`;
          logo.classList.add('hero-float');
          
          initDocking();
        };
      }

      // Handle Resize in Hero Phase
      window.addEventListener('resize', () => {
        if (logo && logo.dataset.phase === 'hero') {
          const absPos = getAbsoluteAnchorPos();
          logo.style.left = absPos.left + 'px';
          logo.style.top = absPos.top + 'px';
        }
      });

      // Counter animation
      function animateCounter(el, target, duration = 1500) {
        if (!el) return;
        const startTime = performance.now();
        const suffix = target.includes('K') ? 'K+' : '+';
        const num = parseInt(target.replace(/\D/g, ''), 10);
        function update(currentTime) {
          const progress = Math.min((currentTime - startTime) / duration, 1);
          el.textContent = Math.floor((1 - Math.pow(1 - progress, 3)) * num) + suffix;
          if (progress < 1) requestAnimationFrame(update);
        }
        setTimeout(() => requestAnimationFrame(update), 3000);
      }
      const statLeads = document.getElementById('statLeads');
      if (statLeads) animateCounter(statLeads, '50K+', 1800);

      /* =========================================
         DOCKING LOGIC - FIXED VERSION
         ========================================= */
      function initDocking() {
        if (!dockSentinel || !logo) return;
        const prefersCoarse = window.matchMedia('(pointer: coarse)').matches;

        function getDockTarget() {
          const pad = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dock-pad')) || 24;
          const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dock-size')) || 64;
          const x = window.innerWidth - size - pad;
          const y = window.innerHeight - size - pad;
          return { x, y, size };
        }

        let animating = false;
        let currentAnim = null; // Track current animation

        function toDock() {
          if (logo.dataset.phase === 'dock' || animating) return;
          animating = true;

          // Cancel any existing animation
          if (currentAnim) {
            currentAnim.cancel();
            currentAnim = null;
          }

          const rect = logo.getBoundingClientRect();
          const baseSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-size')) || 96;
          
          // Switch to FIXED immediately
          logo.style.position = 'fixed';
          logo.style.left = rect.left + 'px';
          logo.style.top = rect.top + 'px';
          
          logo.classList.remove('hero-float');

          const { x, y, size } = getDockTarget();
          const scaleTo = size / baseSize;

          currentAnim = logo.animate([
            { left: rect.left + 'px', top: rect.top + 'px', transform: logo.style.transform },
            { left: x + 'px', top: y + 'px', transform: `scale(${scaleTo})` }
          ], {
            duration: 600,
            easing: 'cubic-bezier(.16, 1, .3, 1)',
            fill: 'forwards'
          });

          setTimeout(() => { logo.dataset.phase = 'dock'; }, 50);

          currentAnim.onfinish = () => {
            currentAnim.cancel(); // CRITICAL: Release fill:forwards
            currentAnim = null;
            
            logo.style.left = x + 'px';
            logo.style.top = y + 'px';
            logo.style.transform = `scale(${scaleTo})`;
            animating = false;
          };

          if (!prefersCoarse) logo.title = 'Open chat';
        }

        function toHero() {
          if (logo.dataset.phase === 'hero' || animating) return;
          animating = true;

          // Cancel any existing animation
          if (currentAnim) {
            currentAnim.cancel();
            currentAnim = null;
          }

          const currentAbs = getAbsoluteAnchorPos();
          const baseSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-size')) || 96;
          const heroScale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-final-scale')) || 2.8;

          const targetViewportX = currentAbs.left - window.scrollX;
          const targetViewportY = currentAbs.top - window.scrollY;

          const { x, y, size } = getDockTarget();
          const startScale = size / baseSize;

          // Get current position (may be mid-animation)
          const rect = logo.getBoundingClientRect();

          logo.dataset.phase = 'hero'; 
          logo.removeAttribute('title');

          currentAnim = logo.animate([
            { left: rect.left + 'px', top: rect.top + 'px', transform: `scale(${startScale})` },
            { left: targetViewportX + 'px', top: targetViewportY + 'px', transform: `scale(${heroScale})` }
          ], {
            duration: 700,
            easing: 'cubic-bezier(.16, 1, .3, 1)',
            fill: 'forwards'
          });

          currentAnim.onfinish = () => {
            currentAnim.cancel(); // CRITICAL: Release fill:forwards
            currentAnim = null;
            
            // Recalculate in case scroll happened
            const finalAbs = getAbsoluteAnchorPos();
            
            logo.style.position = 'absolute';
            logo.style.left = finalAbs.left + 'px';
            logo.style.top = finalAbs.top + 'px';
            logo.style.transform = `scale(${heroScale})`;
            
            logo.classList.add('hero-float');
            animating = false;
          };
        }

        // Sentinel Observer
        const io = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              toHero();
            } else {
              const rect = entry.boundingClientRect;
              if (rect.top < 0) { 
                toDock();
              }
            }
          });
        }, { threshold: 0 });

        io.observe(dockSentinel);

        // Keep dock locked on resize
        window.addEventListener('resize', () => {
          if (logo.dataset.phase === 'dock' && !animating) {
            const { x, y, size } = getDockTarget();
            const baseSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--logo-size')) || 96;
            logo.style.left = x + 'px';
            logo.style.top = y + 'px';
            logo.style.transform = `scale(${size/baseSize})`;
          }
        });
      }

      initPricingToggle();
      initPlayground();
    });

    // Pricing Toggle
    function initPricingToggle() {
      const toggleBtns = document.querySelectorAll('.pricing-toggle .toggle-option');
      if (toggleBtns.length === 0) return;
      const priceValues = document.querySelectorAll('.price-value');
      toggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          toggleBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const period = btn.dataset.period;
          priceValues.forEach(pv => { pv.textContent = pv.dataset[period]; });
        });
      });
    }
    
    // AI Playground
    function initPlayground() {
      const btn = document.getElementById('playgroundBtn');
      const input = document.getElementById('playgroundInput');
      const contextSelect = document.getElementById('playgroundContext');
      const outputContainer = document.getElementById('playgroundOutput');
      const outputText = document.getElementById('outputText');
      const outputPlaceholder = document.getElementById('outputPlaceholder');
      
      if (!btn || !input || !outputContainer) return;

      btn.addEventListener('click', async () => {
        const userMsg = input.value.trim();
        const context = contextSelect ? contextSelect.value : 'business';
        if (!userMsg) return;

        outputContainer.classList.add('loading');
        if (outputPlaceholder) outputPlaceholder.style.display = 'none';
        if (outputText) outputText.textContent = '';
        btn.disabled = true;
        btn.textContent = 'Generating...';

        // Simulated response for demo
        setTimeout(() => {
          const responses = {
            'clothing brand': "Thanks for reaching out! Yes, we offer free standard shipping to Canada on orders over $75 CAD. Express shipping is also available at checkout. Is there anything else I can help you with? 🛍️",
            'saas company': "Great question! We do offer services in Canada. Our pricing is in USD, but you can pay with any major credit card. Would you like me to walk you through our plans?",
            'restaurant': "Hi there! Unfortunately, we don't deliver to Canada as we're a local restaurant. However, if you're ever in town, we'd love to have you! Can I help with anything else?",
            'real estate': "Hello! Yes, we work with international buyers including those from Canada. I'd be happy to discuss financing options and the process. When would be a good time to chat?"
          };
          
          if (outputText) outputText.textContent = responses[context] || responses['clothing brand'];
          outputContainer.classList.remove('loading');
          btn.disabled = false;
          btn.textContent = 'Generate Response ✨';
        }, 1500);
      });
    }
  </script>
</body>
</html>


